<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>GEOS-Chem User's Guide</title>
 <link rel="stylesheet" type="text/css" href="../../../gc.css"><!-- Cascading style sheet for font declarations --></head><body style="background-color: rgb(255, 255, 255);">
<script type="text/javascript" src="../../../geos_backlinks.js"></script>
<!-- JavaScript for breadcrumb links -->
<p class="size20bi" align="center">GEOS&ndash;Chem v9&ndash;02 Online 
  User's Guide</p>

<p class="size14bi" align="center"><a href="chapter_2.html">Previous</a>
| <a href="chapter_4.html">Next</a> | <a href="chapter_3.html" target="_parent">Printable View
(no frames)</a></p>

<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>

<p class="size24bi">3. Compilation </p>

<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size20bi"><a name="Overview" id="Overview"></a>3.1 Overview</p>
<p align="justify">Once you have downloaded the <a href="chapter_2.html#DownCode">GEOS&ndash;Chem source code directory</a>, you can compile GEOS&ndash;Chem. During this process, your Fortran-90 compiler will create a binary executable file from the instructions contained in the various source code modules and files. You can then place the executable file into a <a href="chapter_2.html#DownRun">GEOS&ndash;Chem run directory</a> and start a simulation.</p>
<p align="justify">When you compile GEOS&ndash;Chem, you invoke
  the <a href="http://www.gnu.org/software/make/" target="_new">GNU Make utility</a> with <a href="#Compile">command-line options</a> that set various <a href="#CPP">C&ndash;preprocessor switches</a>.  GNU Make manages the entire compilation process. A series of scripts called <a href="#Makefiles">makefiles</a> directs GNU Make to compile the GEOS&ndash;Chem source code files in the proper order and with the proper options. Each GEOS&ndash;Chem source code subdirectory contains its own makefile.</p>
<p align="justify">For more information about the GEOS&ndash;Chem source code and makefiles, please see:</p>
<ul>
  <li>Chapter 7: <a href="chapter_7.html" align="justify">Coding: Practice and Style</a>.</li>
  <li>GEOS&ndash;Chem wiki: <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/GEOS-Chem_Makefile_Structure" target="_new" align="justify">GEOS&ndash;Chem Makefile Structure</a></li>
</ul>
<p align="justify">NOTE: In general, executables cannot be easily swapped between computers (unless they are identical systems). If you want to move GEOS&ndash;Chem to a different computer, you will more than likely have to recompile it on that system.</p>

<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size20bi"><a name="Dirs" id="Dirs"></a>3.2 Source code directory structure</p>
<p align="justify">We (the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/GEOS-Chem_Support_Team" target="_new">GEOS&ndash;Chem Support Team</a>) have subdivided the <a href="chapter_2.html#DownCode">GEOS&#150;Chem source code directory</a> into several subdirectories. This was done for the following reasons:</p>
<ol>
  <li><p align="justify">To facilitate the installation of 3rd-party software packages such as:</p>
    <ul>
      <li><a href="http://wiki.seas.harvard.edu/geos-chem/index.php/KPP_solvers_FAQ" title="KPP solvers FAQ" target="_new">KPP chemical solver</a></li>
      <li> Aerosol microphysics codes (e.g. <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/APM_aerosol_microphysics" target="_new">APM</a>) </li>
      <li><a href="http://wiki.seas.harvard.edu/geos-chem/index.php/ISORROPIA_II" title="ISORROPIA II" target="_new">ISORROPIA II</a></li>
      <li> Terrestrial models (e.g. CASA, <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Global_Terrestrial_Mercury_Model" title="Global Terrestrial Mercury Model" target="_new">Global Terrestrial Mercury Model</a>), etc.</li>
    </ul>
    <p align="justify"> into GEOS&ndash;Chem.  Our guiding principle is that all 3rd-party   software packages should be cleanly separatable from the mainline GEOS&ndash;Chem code.  This will allow the 3rd-party software packages to be updated without having an impact on the rest of the GEOS&ndash;Chem code.</p>
  </li>
  <li>
    <p align="justify">To simplify the maintenace of the GEOS&ndash;Chem code files. Without subdirectories, there would have been hundreds of source code files in a single directory, and it woud have been very difficult to keep track of them all.</p>
  </li>
</ol>


<p align="justify">The current directory structure is:</p>
<table width="100%" border="1" bordercolor="#000000" cellspacing="0" cellpadding="5">
  <tr>
    <th scope="col" bgcolor="#CCCCCC" width="35%">Directory</th>
    <th scope="col" bgcolor="#CCCCCC">Description</th>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02</tt></td>
    <td><p>Main level GEOS&ndash;Chem directory .</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/GeosApm</tt></td>
    <td><p align="justify">Directory containing parallel copies of GEOS&ndash;Chem source code files (<tt>*.F</tt>) that were modified for the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/APM_aerosol_microphysics" target="_new">APM aerosol microphysics</a> package. </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/GeosCore</tt></td>
    <td><p align="justify">Directory containing regular <tt>*.F</tt> and <tt>*.F90</tt> source code files.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/GeosUtil</tt></td>
    <td><p align="justify">Directory containing various utility modules for GEOS&ndash;Chem: </p>
      <ul>
        <li><tt>bpch2_mod.F</tt></li>
        <li><tt>charpak_mod.F</tt></li>
        <li><tt>directory_mod.F</tt></li>
        <li><tt>error_mod.F</tt></li>
        <li><tt>file_mod.F</tt></li>
        <li><tt>global_grid_mod.F90</tt></li>
        <li><tt>grid_mod.F90</tt></li>
        <li><tt>hdf_mod.F</tt></li>
        <li><tt>ifort_errmsg.F</tt></li>
        <li><tt>inquireMod.F90</tt></li>
        <li><tt>julday_mod.F</tt></li>
        <li><tt>linux_err.c</tt></li>
        <li><tt>pressure_mod.F</tt></li>
        <li><tt>regrid_a2a_mod.F90</tt></li>
        <li><tt>time_mod.F</tt></li>
        <li><tt>transfer_mod.F</tt></li>
        <li><tt>unix_cmds_mod.F</tt></li>
      </ul>
    <p align="justify">This will build these modules into a separate library, which will allow   these modules to be called from code in other subdirectories.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/GTMM</tt></td>
    <td><p align="justify">Directory containing GEOS&ndash;Chem source code files (<tt>*.F90</tt>) for the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Global_Terrestrial_Mercury_Model" target="_new">Global Terrestrial Mercury Model (GTMM)</a> simulation. </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/Headers</tt></td>
    <td><p>Directory containing the various GEOS&ndash;Chem Header modules, which contain many parameters and global arrays for GEOS&ndash;Chem routines.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/ISOROPIA</tt></td>
    <td><p align="justify">Directory containing the unmodified <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/ISORROPIA_II" target="_new">ISORROPIA II</a> source code files from Thanos Nenes and Havala Pye: </p>
      <ul>
        <li><tt>isorropiaIIcode.F</tt></li>
        <li><tt> isrpia.inc</tt></li>
    </ul></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/KPP</tt></td>
    <td><p align="justify">Main-level directory for the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/KPP_solvers_FAQ" target="_new">KPP solver</a></p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/KPP/int</tt></td>
    <td><p align="justify">Directory containing KPP integrator files (i.e. rosenbrock, radau, runge-kutta, lsodes) </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/KPP/SOA</tt></td>
    <td><p>Directory containing KPP source code files for 93 tracer simulation (with <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Secondary_organic_aerosols" target="_new">secondary organic aerosols</a>) </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/KPP/standard</tt></td>
    <td><p align="justify">Directory containing KPP source code files for 66 tracer simulation (with bromine, and without  secondary organic aerosols) </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/NcdfUtil</tt></td>
    <td><p align="justify">Directory containing netCDF I/O code. This code is from Bob Yantosca's NcdfUtilities package.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/NcdfUtil/perl</tt></td>
    <td><p align="justify">Directory containing perl scripts from the NcdfUtilities package that can be used to generate Fortran code for defining, writing, and reading a netCDF file.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/bin</tt></td>
    <td><p align="justify">Directory where executable (<tt>geos</tt>,<tt> geostomas, geosapm</tt>) files will be sent </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/doc</tt></td>
    <td><p align="justify">Directory where automatic documentation is built </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/help</tt></td>
    <td><p align="justify">Directory containing GEOS&ndash;Chem help screen</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/lib</tt></td>
    <td><p align="justify">Directory where library (<tt>*.a</tt>) files will be created </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/mod</tt></td>
    <td><p align="justify">Directory where module (<tt>*.mod</tt>) files will be sent </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/obsolete</tt></td>
    <td><p align="justify">Directory where obsolete source code files are placed for future reference if need be</p></td>
  </tr>  
</table>
<p align="justify">NOTE: In <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/GEOS-Chem_v9-02" target="_new">GEOS&ndash;Chem v9&ndash;02</a>, the <tt>Code.v9-02/GeosTomas</tt> directory has been removed and  code for the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/TOMAS_aerosol_microphysics" title="TOMAS aerosol microphysics" target="_new">TOMAS aerosol microphysics</a> package has been inlined into the <tt>GeosCore</tt> directory using C-preprocessor statements. See <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/TOMAS_aerosol_microphysics#Update_April_2013" target="_new">this wiki page</a> for more information.</p>
<p align="justify">In the text below, we shall often omit the top-level <tt>Code.v9-02</tt> directory and refer to files by their subdirectory only, such as:</p>
<ul>
  <li><tt align="justify">Headers/define.h</tt>, </li>
  <li><tt align="justify">GeosCore/dao_mod.F</tt></li>
  <li><tt align="justify">ISOROPIA/isoropiaII_code.F</tt>, etc.</li>
</ul>
<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size20bi"><a name="Makefiles" id="Makefiles"></a>3.3 GEOS&ndash;Chem Makefiles</p>
  
<p align="justify">The GEOS&ndash;Chem compilation process is managed by <strong>makefiles</strong> located throughout the <a href="chapter_2.html#DownCode">source code directory</a>. Makefiles direct the <a href="http://www.gnu.org/software/make/" target="_new">GNU Make utility</a> to execute the various compilation commands in  the proper sequence.</p>
<p>In general there are 2 types of makefiles: </p>
<ul>
  <li>
    <p align="justify"><strong><em>Router</em> makefiles</strong>: Makefiles that tell GNU Make to look at makefiles in other directories.</p>
  </li>
  <li>
    <p align="justify"><strong><em>Regular</em> makefiles</strong>: Makefiles that are used by GNU Make to compile source code programs..</p>
  </li>
</ul>
<p align="justify">The  top-level source code directory (<tt>Code.v9-02</tt>) contains a <em>router</em> makefile, which  calls down to the   <em>regular</em> makefiles in the various <a href="#Dirs">subdirectories</a>. In each subdirectory, the <em>regular</em> makefile tells GNU Make how to compile the source code files. When the source code in all subdirectories has been compiled, the top-level Makefile tells GNU Make to create the GEOS&ndash;Chem executable file.</p>
<p align="justify">Here is a list of makefiles used by GEOS&ndash;Chem:</p>
<table width="100%" border="1" bordercolor="#000000" cellspacing="0" cellpadding="5">
  <tr>
    <th scope="col" bgcolor="#CCCCCC" width="40%">Directory</th>
    <th scope="col" bgcolor="#CCCCCC">Description</th>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/Makefile</tt></td>
    <td><p align="justify">Main-level router makefile; calls down to makefiles in other subdirectories.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/Makefile_header.mk</tt></td>
    <td><p align="justify">Makefile fragment that defines compilation and linking commands      for the IFORT and PGI compilers.    These commands are common to the makefiles in all subdirectories.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/GeosApm/Makefile</tt></td>
    <td><p align="justify">Makefile to build the GEOS&ndash;Chem code with <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/APM_aerosol_microphysics" title="APM aerosol microphysics" target="_new">APM aerosol microphysics</a> routines. </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/GeosCore/Makefile</tt></td>
    <td><p align="justify">Makefile to build the GEOS&ndash;Chem code.  Also calls up to makefiles    in the other subdirctories to build 3rd-party codes (e.g. KPP). </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/GeosUtil/Makefile</tt></td>
    <td><p align="justify">Makefile to build the GEOS&ndash;Chem utility modules.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/Headers/Makefile</tt></td>
    <td><p align="justify">Makefile to build the GEOS&ndash;Chem Headers modules.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/GTMM/Makefile</tt></td>
    <td><p align="justify">Makefile to build the GEOS&ndash;Chem code with <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Global_Terrestrial_Mercury_Model" target="_new">GTMM</a> routines. </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/ISOROPIA/Makefile</tt></td>
    <td><p align="justify">Makefile to build the GEOS&ndash;Chem code with <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/ISORROPIA_II" target="_new">ISORROPIA II</a> code. </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/KPP/Makefile</tt></td>
    <td><p align="justify">Router makefile for KPP.  Calls down to makefiles in subdirectories to build the KPP solver code. </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/KPP/SOA/Makefile</tt></td>
    <td><p align="justify">Makefile that builds the KPP solver for the GEOS&ndash;Chem 93 tracer simulation.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/KPP/standard/Makefile</tt></td>
    <td><p align="justify">Makefile that builds the KPP solver for the GEOS&ndash;Chem 66 tracer simulation.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/NcdfUtil/Makefile</tt></td>
    <td><p align="justify">Makefile to build the NcdfUtilities library routines.</p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/doc/Makefile</tt></td>
    <td><p align="justify">Makefile that builds GEOS&ndash;Chem documentation files with LaTeX.    Documentation files will be produced in both <tt>*.pdf</tt> and <tt>*.ps</tt> formats. </p></td>
  </tr>
  <tr>
    <td valign="top"><tt>Code.v9-02/help/Makefile</tt></td>
    <td><p align="justify">Makefile that displays the GEOS&ndash;Chem help screen.</p></td>
  </tr>
 
</table>  
  
<p align="justify">You will usually not have to modify any of these makefiles, unless you are adding new code into GEOS&ndash;Chem. If you need to modify makefiles, then   <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/GEOS-Chem_Support_Team" target="_new">we will be happy to assist you</a>.</p>
<p align="justify">Each makefile controls several <a href="#Compile">compilation options</a>, which are discussed in detail below.</p>
<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size20bi"><a name="CPP" id="CPP"></a>3.4 Setting the C&ndash;preprocessor switches</p>
<p align="justify">GEOS&ndash;Chem relies on several different <strong>C&ndash;preprocessor switches</strong> to inform the Fortran-90 compiler which options you want to include into the executable file. In this section we provide an overview of how C&ndash;preprocessor switches work.</p>

<p align="justify" class="size18bi"><a name="WhatIsCPP" id="WhatIsCPP"></a>3.4.1 What is the C&ndash;preprocessor?</p>
<p align="justify">The C&ndash;preprocesor (or CPP for short) is a feature of the C and C++ programming languages that allows you to compile blocks of code only if  certain conditions are met.  For example, let's say you have two blocks of code, Block A and Block B. If you set a certain switch in the code, then Block A will get compiled into the executable but Block B will not. When you run the executable, it will behave as if Block B had never existed. If you set a different switch, then Block B will be compiled but Block A will not, and the executable will behave as if Block A had never existed.</p>
<p align="justify">All modern Fortran compilers have inherited the  C&ndash;preprocessor feature.  Some Fortran compilers even call it the &quot;Fortran preprocessor&quot; (FPP). Therefore, even though GEOS&ndash;Chem is written in Fortran-90, we can still incorporate   C&ndash;preprocesor commands into the source code.</p>
<p align="justify">With the    C&ndash;preprocessor, you can design software to handle many different conditions, such as multiple compiler/platform combinations, different file formats, and the like. At compilation time, you can direct the C&ndash;preprocessor to only choose the options relevant to the particular computer system you are running on.   Options that are not relevant to your system will  be ignored. This is a standard programming technique.</p>
<p align="justify">The C&ndash;preprocessor statments take the form of <tt>#define</tt> and <tt>#if - #endif</tt> statements. A simple example from GEOS&ndash;Chem is:</p>
<blockquote>
<pre>#if   defined( GEOS_4 )
      WRITE( 6, '(a)' ) 'Using GMAO GEOS-4 met fields'
#elif defined( GEOS_5 )
      WRITE( 6, '(a)' ) 'Using GMAO GEOS-5 met fields'
#elif defined( GEOS_FP )
      WRITE( 6, '(a)' ) 'Using GMAO GEOS-FP met fields'
#elif defined( MERRA )
      WRITE( 6, '(a)' ) 'Using GMAO MERRA met fields'
#elif defined( GCAP  )
      WRITE( 6, '(a)' ) 'Using GCAP/GISS met fields'
#endif</pre>
</blockquote>

<p align="justify">Here the <tt>#elif</tt> tag stands for &quot;else if&quot;. An <tt>#else</tt> tag is also allowed.</p>
<p align="justify">If we have <tt>#defined</tt> the <tt>GEOS_5</tt> <a href="#SetCPP">C&ndash;preprocessor switch</a>, then  GEOS&ndash;Chem will be compiled for use with the <a href="appendix_4.html#GEOS-5">GEOS&ndash;5 met fields</a>. The block of code that prints out the message <tt>"Using GMAO GEOS-5 met fields"</tt> will be built into the exectuable, and all other print statements will be ignored.</p>
<p align="justify">C&ndash;preprocessor statements must be placed into the first column of a Fortran source code file, or else you may encounter a syntax error.</p>
<p align="justify"><span class="size18bi"><a name="SetCPP" id="SetCPP"></a>3.4.2 Selecting the proper C&ndash;preprocessor switches for your simulation</span></p>
<p>GEOS&ndash;Chem uses C&ndash;preprocessor switches to select  various options, including:</p>
<ol>
  <li>The <a href="appendix_4.html">meteorological fields</a> that GEOS&ndash;Chem will use</li>
  <li>The <a href="appendix_2.html">horizontal</a> and <a href="appendix_3.html">vertical grids</a> for the GEOS&ndash;Chem simulation</li>
  <li>The type of compiler you will use to create the GEOS&ndash;Chem executable</li>
  <li>Options  for special simulations (e.g. <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Mercury" target="_new">mercury</a>)</li>
  <li>Debugging options</li>
</ol>
<p>These switches are set with <a href="#Makefile">Makefile options</a> from the command line.</p>

<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>

<p class="size20bi"><a name="Compile" id="Compile"></a>3.5 Compiling the GEOS&ndash;Chem source code</p>

<p align="justify">To compile GEOS&ndash;Chem, you need to be in the <tt>Code.v9-02</tt> top-level directory. There are a large choice of compilation options available. The list of options can be printed to the screen by typing:</p> 
<blockquote><pre>make help</pre></blockquote>
<p align="justify" class="size18bi"><a name="Makefile" id="Makefile"></a>3.5.1 Makefile options</p>
<p align="justify"> To compile GEOS&ndash;Chem, you will invoke <a href="http://www.gnu.org/software/make/" target="_new">GNU Make</a> with the following syntax:</p>
<blockquote><p align="justify"><tt>make -jN TARGET REQUIRED-FLAGS [ OPTIONAL-FLAGS ]</tt></p></blockquote>
<p align="">In the table below, we list all of the targets and flags that you can use to customize your GEOS&ndash;Chem simulation.
<blockquote>
  <table width="90%" border="1" cellpadding="5" cellspacing="0" bordercolor="#000000">
      <tr>
        <th colspan="2" style="vertical-align: top; background-color: rgb(153, 153, 153); text-align: center;">Make options<br></th>
      </tr>
      <tr>
        <th align="left" bgcolor="#cccccc" valign="top">Option</th>
        <th style="vertical-align: top; text-align: left; background-color: rgb(204, 204, 204);">Description </th>
      </tr>
      <tr>
        <td style="vertical-align: top;"class="courier16">-jN</td>
        <td style="vertical-align: top;">Enables you to compile N files simultaneously. This will shorten the total compilation time. <em><strong>(RECOMMENDED!)</strong></em></td>
      </tr>

    <tr>
      <th colspan="2" style="text-align: center; background-color: rgb(153, 153, 153); vertical-align: middle;">Targets<br></th>
    </tr>
    <tr>
      <th align="left" bgcolor="#cccccc" valign="top"width="20%">Target name</th>
      <th style="vertical-align: top; text-align: left; background-color: rgb(204, 204, 204);">Description </th>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">all</td>
      <td style="vertical-align: top;"> Default target (synonym for "lib exe")
      </td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">lib</td>
      <td style="vertical-align: top;">Builds all GEOS&ndash;Chem source code (synonym for "libkpp libutil libcore")
      </td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">libcore</td>
      <td style="vertical-align: top;">Only builds GEOS&ndash;Chem objects &amp; libraries in <tt>GeosCore</tt> subdirectory</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">libiso</td>
      <td style="vertical-align: top;">Only builds GEOS&ndash;Chem objects &amp; libraries in <tt>ISOROPIA</tt> subdirectory</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">libkpp</td>
      <td style="vertical-align: top;">Only builds GEOS&ndash;Chem objects &amp; libraries in <tt>KPP</tt> subdirectory</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">libnc</td>
      <td style="vertical-align: top;">Only builds GEOS&ndash;Chem objects &amp; libraries in <tt>NcdfUtil</tt> subdirectory</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">ncdfcheck</td>
      <td style="vertical-align: top;">Checks that your netCDF library has been installed properly</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">libutil
      </td>
      <td style="vertical-align: top;">Only builds GEOS&ndash;Chem objects &amp; libraries in <tt>GeosUtil</tt> subdirectory</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">libheaders
      </td>
      <td style="vertical-align: top;">Only builds GEOS&ndash;Chem objects &amp; libraries in <tt>Headers</tt> subdirectory</td>
    </tr>
    <tr>
        <td class="courier16" style="vertical-align: top;">exe</td>
        <td style="vertical-align: top;">Build GEOS&ndash;Chem executable</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">clean</td>
        <td style="vertical-align: top;">Removes <tt>*.o</tt>, <tt>*.mod</tt>, <tt>geos*</tt> files in source code subdirs only</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">realclean</td>
        <td style="vertical-align: top;">Removes all <tt>*.o</tt>, <tt>*.mod</tt>, <tt>geos*</tt>, <tt>lib*.a</tt>, <tt>*.tex</tt>, <tt>*.ps</tt>, <tt>*.pdf</tt> files everywhere</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">doc</td>
        <td style="vertical-align: top;">Builds GEOS&ndash;Chem documentation (<tt>*.ps</tt>, <tt>*.pdf</tt>) with ProTeX in <tt>doc</tt> subdir</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">docclean</td>
        <td style="vertical-align: top;">Removes <tt>*.tex</tt>, <tt>*.ps</tt>, <tt>*.pdf</tt> from the <tt>doc</tt> subdir</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">help</td>
        <td style="vertical-align: top;">Displays the help screen</td>
      </tr>
      <tr>
        <th colspan="2" rowspan="1" bgcolor="#CCFFFF">Optional targets for  the  APM aerosol microphysics package</th>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">apm</td>
        <td style="vertical-align: top;">Builds GEOS&ndash;Chem + <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/APM_aerosol_microphysics" title="APM aerosol microphysics" target="_new">APM</a> code (synonym for "<tt>libapm exeapm</tt>")</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">libapm</td>
        <td style="vertical-align: top;">Builds GEOS&ndash;Chem + APM objects & libraries in <tt>GeosApm</tt> directory</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">exeapm</td>
        <td style="vertical-align: top;">Builds GEOS&ndash;Chem + APM executable in <tt>GeosApm</tt> directory </td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">cleanapm</td>
        <td style="vertical-align: top;">Removes <tt>*.o *.mod</tt> files in <tt>GeosApm</tt> directory only</td>
      </tr>
      <tr>
        <th colspan="2" rowspan="1" bgcolor="#CCFFFF">Optional targets for the Global Terrestrial Mercury Model</th>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">allhg</td>
        <td style="vertical-align: top;">Builds GEOS&ndash;Chem + <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Global_Terrestrial_Mercury_Model" target="_new">GTMM</a> code (synonym for "<tt>libhg exehg</tt>")</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">libhg</td>
        <td style="vertical-align: top;">Builds GEOS&ndash;Chem + GTMM objects &amp; libraries in <tt>GeosCore</tt> and <tt>GTMM</tt> directories</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">libgtmm</td>
        <td style="vertical-align: top;">Builds GEOS&ndash;Chem + GTMM objects &amp; libraries in <tt>GTMM</tt> directory</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">exehg</td>
        <td style="vertical-align: top;">Builds GEOS&ndash;Chem + GTMM executable in <tt>GTMM</tt> directory</td>
      </tr>
      <tr>
        <th colspan="2" style="vertical-align: middle; background-color: rgb(153, 153, 153); text-align: center;">Required flags<br></th>
      </tr>
    <tr>
        <th style="vertical-align: top; background-color: rgb(204, 204, 204);">Flag name<br>
        </th>
        <th style="vertical-align: top; background-color: rgb(204, 204, 204);">Description</th>
    </tr>
    <tr>
        <td class="courier16" style="vertical-align: top;">MET=___</td>
        <td style="vertical-align: top;">Select the <a href="appendix_4.html">meteorological field type </a> that GEOS&ndash;Chem will use. Options are:
          <ul>
          <li><tt>gcap</tt>: Use GISS met fields for <a href="appendix_4.html#GCAP">GCAP</a> simulation (<a href="appendix_3.html#GCAP">23 layer</a>, <a href="appendix_2.html#GCAP_4x5">4&deg; x 5&deg;</a>)</li>
          <li><tt>geos4</tt>: Use <a href="appendix_4.html#GEOS-4">GEOS&ndash;4</a> met fields (<a href="appendix_3.html#GEOS-4_native">55 layer</a>, hybrid, 1985&ndash;2006)</li>
          <li><tt>geos5</tt>: Use <a href="appendix_4.html#GEOS-5">GEOS&ndash;5</a> met fields (<a href="appendix_3.html#GEOS-5_native">72 layer</a>, hybrid, 2005&ndash;2012)</li>
          <li><tt>geos-fp</tt>: Use <a href="appendix_4.html#GEOS-FP">GEOS&ndash;FP</a> met fields (<a href="appendix_3.html#GEOS-FP_native">72 layer</a>, hybrid, 2012&ndash;present)</li>
          <li><tt>merra</tt>: Use <a href="appendix_4.html#MERRA">MERRA</a> met fields (<a href="appendix_3.html#MERRA_native">72 laye</a>r, hybrid, 1979&ndash;2010)</li>
        </ul></td>
      </tr>
    <tr>
        <td class="courier16" style="vertical-align: top;">GRID=___</td>
        <td style="vertical-align: top;">Select the <a href="appendix_2.html">horizontal grid</a> for the GEOS&ndash;Chem simulation. Options are:
          <ul>
          <li><tt>025x03125</tt>: Use <a href="appendix_2.html#GMAO_025">0.25&deg; x 0.3125&deg; nested grids</a> (<a href="appendix_4.html#GEOS-FP">GEOS&ndash;FP</a> only)</li>
          <li><tt>05x0667</tt>: Use <a href="appendix_2.html#GMAO_05">0.5&deg; x 0.667 &deg; nested grids</a> (<a href="appendix_4.html#GEOS-5">GEOS&ndash;5</a> only)</li>
          <li><tt>1x125</tt>: Use <a href="appendix_2.html#GMAO_1x125">1&deg; x 1.25&deg;</a> grid (<a href="appendix_4.html#GEOS-4">GEOS&ndash;4</a> only)</li>
          <li><tt>2x25</tt>: Use <a href="appendix_2.html#GMAO_2x25">2&deg; x 2.5&deg;</a> grid</li>
          <li><tt>4x5:</tt>: Use <a href="appendix_2.html#GMAO_4x5">4&deg; x 5&deg;</a> grid</li>
        </ul></td>        
    </tr>
    <tr>
      <th colspan="2" style="vertical-align: middle; background-color: rgb(153, 153, 153); text-align: center;">Optional flags<br>
      </th>
    </tr>
    <tr>
      <th style="vertical-align: top; background-color: rgb(204, 204, 204);">Flag name<br>
      </th>
      <th style="vertical-align: top; background-color: rgb(204, 204, 204);">Description</th>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">COMPILER=___</td>
      <td style="vertical-align: top;">Choice of the compiler. Options: <tt>ifort pgi </tt>(Default is <tt>ifort</tt>)</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">NEST=___</td>
      <td style="vertical-align: top;">Select the nested-grid domain for the GEOS&ndash;Chem simulation. Options are:
        <ul>
          <li><tt>ch</tt>: Use CH (China) nested grid (<a href="appendix_2.html#GMAO_05_CH">GEOS&ndash;5</a> and <a href="appendix_2.html#GMAO_025_CH">GEOS&ndash;FP</a> only)</li>
          <li><tt>eu</tt>: Use EU (Europe) nested grid (<a href="appendix_2.html#GMAO_05_NA">GEOS&ndash;5</a> and <a href="appendix_2.html#GMAO_025_NA">GEOS&ndash;FP</a> only)</li>
          <li><tt>na</tt>: Use NA (North America) nested-grid (<a href="appendix_2.html#GMAO_05_NA">GEOS&ndash;5</a> and <a href="appendix_2.html#GMAO_025_NA">GEOS&ndash;FP</a> only)</li>
          <li><tt>se</tt>: Use extended SE Asia nested grid (<a href="appendix_2.html#GMAO_025_SE">GEOS&ndash;FP</a> only)</li>
        </ul></td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">NO_REDUCED=yes</td>
      <td style="vertical-align: top;">Compiles GEOS&ndash;Chem with the full vertical grid (no)or reduced vertical grid. (Default is no)
    </tr>
    <tr>
      <th colspan="2" rowspan="1" bgcolor="#CCFFFF">Parallelization and optimization options</tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">OMP=yes</td>
      <td style="vertical-align: top;">Turns OpenMP parallelization on/off (Default is yes)</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">NONUMA=yes</td>
      <td style="vertical-align: top;">Turns on <tt>-mp=nonuma</tt> option (<tt>pgi</tt> only)</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">IPO=yes</td>
      <td style="vertical-align: top;">Turns on optmization options <tt>-ipo -static</tt> for the <tt>ifort</tt> compiler. (Default is no)</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">OPT=___</td>
      <td style="vertical-align: top;">Specifies a different optimization level than the default setting. (Default is <tt>-O2</tt>)</td>
    </tr>
    <tr>
      <th colspan="2" rowspan="1" bgcolor="#CCFFFF">KPP chemistry solver options<tr>
      <td class="courier16" style="vertical-align: top;">CHEM=___</td>
      <td style="vertical-align: top;">Specifies which simulation is done. Options: <tt>standard</tt>, <tt>SOA</tt> (Default is <tt>standard</tt>). </td>
    </tr>
    <tr>
      <td height="49" class="courier16" style="vertical-align: top;">KPPSOLVER=___</td>
      <td style="vertical-align: top;">Specifies the integrator used w/ KPP:<br>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Options: <tt>lsodes radau5 rosenbrock runge_kutta</tt> (Default is <tt>rosenbrock</tt>)</td>
    </tr>
    <tr>
      <th colspan="2" rowspan="1" bgcolor="#CCFFFF">Debugging options</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">TRACEBACK=yes</td>
      <td style="vertical-align: top;">Turns on <tt>-traceback</tt>, which prints the error trace stack (Default is no)</td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">DEBUG=yes</td>
      <td style="vertical-align: top;">Compiles GEOS&ndash;Chem for use w/ a debugger (Default is no) </td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">BOUNDS=yes</td>
      <td style="vertical-align: top;">Turns on subscript-array checking  (Default is no) </td>
    </tr>
    <tr>
      <td class="courier16" style="vertical-align: top;">FPE=yes</td>
      <td style="vertical-align: top;">Turns on checking for floating-point exceptions (Default is no)</td>
    </tr>
    <tr>
      <th colspan="2" rowspan="1" bgcolor="#CCFFFF">TOMAS aerosol microphysics package options</tr>
<tr>
        <td class="courier16" style="vertical-align: top;">TOMAS=yes</td>
        <td style="vertical-align: top;">Build GEOS&ndash;Chem for 30-bin <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/TOMAS_aerosol_microphysics" target="_new">TOMAS aerosol microphysics</a>
        </td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">TOMAS12=yes</td>
        <td style="vertical-align: top;">Build GEOS&ndash;Chem for 12-bin TOMAS aerosol microphysics</td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">TOMAS15=yes</td>
        <td style="vertical-align: top;">Build GEOS&ndash;Chem for 15-bin TOMAS aerosol microphysics</a></td>
      </tr>
      <tr>
        <td class="courier16" style="vertical-align: top;">TOMAS40=yes</td>
        <td style="vertical-align: top;">Build GEOS&ndash;Chem for 40-bin TOMAS aerosol microphysics</td>
      </tr>
</table>
</blockquote>
<p align="justify">Please note the following:</p>
<ol>
  <li>
    <p align="justify">You must specify a value for <tt>MET</tt>.  Allowable values are:  <tt>MET=gcap MET=geos4 MET=geos5 MET=geos-fp MET=merra</tt>.</p>
  </li>
  <li>
    <p align="justify">You must specify a value for <tt>GRID</tt>.  Allowable values are:   <tt>GRID=025x03125 GRID=05x0666 GRID=2x25 GRID=4x5</tt>.</p>
  </li>
  <li>
    <p>If you have selected <tt>GRID=025x03125</tt>
    or <tt>GRID=05x0666</tt>, then you must also select <tt>NEST=ch</tt>, <tt>NEST=na</tt>, <tt>NEST=eu</tt>, or <tt>NEST=se</tt>. This will select the proper <a href="appendix_2.html#GMAO_025">0.25&deg; x 0.3125&deg;</a> or  <a href="appendix_2.html#GMAO_05">0.5&deg; x 0.666&deg;</a> nested grid region (CH, NA, EU, SE)</p>
  </li>
  <li>
    <p align="justify">Makefile target names are case-sensitive. For example, you should type  <tt>make all</tt> but not <tt>make ALL</tt>.</p>
  </li>
  <li>
    <p align="justify">Makefile flags will accept  case-insensitive input. You may also omit dashes from met field names. The following permutations are acceptable:  <tt>MET=geos5 MET=Geos5 MET=GEOS-5 MET=geosfp MET=Geos_Fp</tt>, etc.</p>
  </li>
  <li>
    <p align="justify">Makefile flags that  require a simple yes/no answer will accept case-insensitive input (e.g. <tt>DEBUG=yes</tt> <tt>DEBUG=Yes</tt> <tt>DEBUG=y</tt>, <tt>DEBUG=No</tt>, <tt>DEBUG=n</tt>).</p>
  </li>
  <li>
    <p align="justify">Whenevery you want to change the met field type or horizontal grid settings, you should  issue a <tt>make realclean</tt> command.  This will remove all previously-created compiler output files (e.g. <tt>*.a</tt>, <tt>*.o</tt>, <tt>*.mod</tt>) and executables. After doing make realclean, you can recompile GEOS&ndash;Chem again with your new options.  </p>
  </li>
</ol>
<p align="justify">When starting with a new version of GEOS&ndash;Chem, you should always issue this command:</p>
<blockquote><pre>make realclean</pre></blockquote>
<p align="justify">This will clear out any precompiled files and executables (if any have been left in the source code directory inadvertently).</p>
<p align="justify">The default target is <tt>all</tt>.  This option, which will cause GNU Make to compile the GEOS&ndash;Chem source code and create the executable file, will be selected if you type either</p>
<blockquote><pre>make</pre></blockquote>
<p align="justify">or</p>
<blockquote><pre>make all</pre></blockquote>
<p align="justify"><span class="size18bi"><a name="Optional" id="Optional"></a>3.5.2 Optional flags and defaults</span></p>
<p align="justify">To build GEOS&ndash;Chem, you need to specify one of the makefile targets listed above (see <a href="#Makefile">Chapter 3.5.1</a>), plus optional flags.</p>
<p align="justify">Several of the optional flags have default settings:</p>
<ol>
  <li>The default compiler is the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Intel_Fortran_Compiler" target="_new">Intel Fortran Compiler</a> (ifort)</li>
  <li>The default NOx-Ox-HC-aerosol chemistry (aka &quot;full-chemistry) simulation is  <strong>&quot;standard&quot;</strong> (66 advected tracers, no secondary organic aerosols)</li>
  <li><a href="http://wiki.seas.harvard.edu/geos-chem/index.php/KPP_solvers_FAQ" target="_new">The KPP chemical solver</a> will use the <strong>Rosenbrock integrator</strong> by default</li>
  <li><a href="chapter_7.html#OpenMP">OpenMP parallelization</a> is turned on</li>
</ol>
<p align="justify">Finally, any of the optional flags can be specified in one of two ways:</p>
<ol>
  <li>
    <p align="justify"><strong>As a command-line argument to the GNU Make utility</strong>:<br>
    For example, if we want to use the PGI compiler instead of the Intel Fortran Compiler, we could type:</p>
    <blockquote>
    <pre>make -j4 MET=geos5 GRID=4x5 COMPILER=pgi ...</pre></blockquote>
  </li>
  <li>
    <p align="justify"><strong>As an Unix environment variable:</strong><br>
    If you want to use the PGI compiler, but do not wish to keep typing <tt>COMPILER=pgi</tt> every time you call <a href="http://www.gnu.org/software/make/" target="_new">GNU Make</a>, you could type this instead:</p>
<blockquote>
  <pre>setenv MET geos5<br>setenv GRID 4x5<br>setenv COMPILER pgi
make -j4 ... </pre></blockquote>
  </li>
</ol>
<p align="justify">For clarity, we shall use command-line arguments in the examples below.</p>
<p align="justify"><span class="size18bi"><a name="Examples" id="Examples"></a>3.5.3 Examples</span></p>
<p align="justify">To build the GEOS&ndash;Chem executable with all defaults (<a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Intel_Fortran_Compiler" target="_new">Intel Fortran Compiler</a>, 66-tracer full-chemistry mechanism, <a href="chapter_7.html#OpenMP">OpenMP parallelization</a> turned on) one can simply type: </p>
<blockquote>
 <pre>make -j4 MET=geos5 GRID=4x5</pre></blockquote>
<p align="justify">Here we have used the <tt>-j4 </tt>option to split the compilation among 4 processors (assuming you have  this many processors available to you).  This reduces the total compilation time drastically!  Here we've used  use <tt>MET=geos5</tt> and <tt>GRID=4x5</tt> but you can specify different values for these flags.</p>
<p align="justify">If you wanted to select a different compiler (e.g. PGI), but keep all of the other defaults, type:</p>
<blockquote>
  <pre>make -j4 MET=geos5 GRID=4x5 COMPILER=pgi</pre></blockquote>
<p align="justify">Depending on your PGI compiler setup, you may also have to add the PGI option <tt>NONUMA=yes.</tt></p>
<p align="justify">If you wish to turn off the parallelization (e.g. for debugging purposes), you can type:</p>
<blockquote>
 <pre>make -j4 MET=geos5 GRID=4x5 OMP=no</pre></blockquote>
<p align="justify">To invoke the Intel Fortran Compiler's  <tt>-traceback</tt> debugging option (which prints the list of routines that were being called at the point when the run died), type:</p>
<blockquote>
 <pre>make -j4 MET=geos5 GRID=4x5 TRACEBACK=yes</pre></blockquote>
<p align="justify">If you want to test for<a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Common_GEOS-Chem_error_messages#Array-out-of-bounds_error" target="_new"> array-out-of-bounds errors</a>, then type: </p>
<blockquote>
 <pre>make -j4 MET=geos5 GRID=4x5 BOUNDS=yes</pre></blockquote>
<p align="justify">If you wish to use a debugger (like Totalview) to debug a multi-processor GEOS&ndash;Chem simulation, type:</p>
<blockquote>
  <pre>make -j4 MET=geos5 GRID=4x5 DEBUG=yes</pre></blockquote>
<p align="justify">If you wish to use a debugger (like Totalview) to debug a single-processor GEOS&ndash;Chem simulation, type:</p>
<blockquote>
 <pre>make -j4 MET=geos5 GRID=4x5 DEBUG=yes OMP=no</pre></blockquote>
<p align="justify">If you wish to compile the code and build the executable in two separate steps, you may type: </p>
<blockquote>
 <pre>make -j4 MET=geos5 GRID=4x5 lib
make -j4 MET=geos5 GRID=4x5 exe</pre></blockquote>
<p align="justify">To automatically generate the GEOS&ndash;Chem Reference Guide documentation in PostScript and PDF formats, type: </p>
<blockquote><pre>make doc</pre></blockquote>
<p align="justify">To remove all compiler-produced files (i.e. <tt>*.o</tt>, <tt>*.mod</tt>) and executable files from the source code directories (but not from the mod, lib, bin directories), type: </p>
<blockquote><pre>make clean</pre></blockquote>
<p align="justify">And to remove everything and start over from scratch, type: </p>
<blockquote><pre>make realclean</pre></blockquote>
<p align="justify">Please note:</p>
<ol>
  <li>
    <p align="justify">On some systems, the <a href="http://www.gnu.org/software/make/" target="_new">GNU Make</a> command will be called <tt>gmake</tt> instead of <tt>make</tt>.</p>
  </li>
  <li>
    <p align="justify">We recommend updating your compiler to <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Intel_Fortran_Compiler" target="_new">Intel
      Fortran Compiler</a> (IFORT)  Version 11.1.058 or higher versions.  <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Intel_Fortran_Compiler#Timing_results:_IFORT_11_vs._IFORT_10" target="_new">Version 11 produces similar results to Version 10</a>.</p>
  </li>
  <li>
    <p align="justify">We also recommend that PGI compiler
      users migrate to Intel Fortran Compiler (IFORT) Version 11.1.058 or higher.</p>
  </li>
  <li>
    <p align="justify">For more information about debugging array-out-of-bounds errors, please see <a href="chapter_7.html#Debugging">Chapter
      7.2, GEOS&ndash;Chem debugging tips</a>.</p>
  </li>
</ol>
<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>

<p class="size20bi"><a name="Advanced" id="Advanced"></a>3.6 Advanced compilation techniques</p>
<p align="justify">Here we describe a couple of methods by which you may partially automate the compilation process.</p>

<p class="size18bi"><a name="Shell" id="Shell"></a>3.6.1 Compiling GEOS&ndash;Chem with from  Unix shell scripts</p>


<p align="justify">It is possible to write a shell script
 to compile the GEOS&ndash;Chem code, such as the following:</p>

<blockquote>
  <pre>#!/bin/tcsh -f                       # Script definition line
cd Code.v9-02                        # your code dir
rm -f log                            # clear log file
make -j4 MET=geos5 GRID=4x5 > log    # build the code
exit(0)                              # exit normally</pre>
</blockquote>
<p align="justify">You can then run this script interactively, or submit it to the queueing system on your computer cluster.</p>

<p class="size18bi"><a name="RunDir" id="RunDir"></a>3.6.2 Compiling GEOS&ndash;Chem with a run-directory  Makefile</p>

<p align="justify">The  <a href="http://www.gnu.org/software/make/" target="_new">GNU Make utility</a> is a powerful and flexible software development tool. With a little effort, you can design a Makefile that can be placed into your <a href="chapter_2.html#DownRun">GEOS&ndash;Chem run directory</a> that will create a GEOS&ndash;Chem executable and start a simulation. Here is an example:</p>
<blockquote>
  <pre># This makefile is a &quot;router&quot; makefile.  It calls the Makefile
# in the GEOS-Chem code directory (with various user-supplied options) 
# to build and run the GEOS-Chem model.<br>
# Define variables
SHELL   = /bin/bash

# Make the development version "Code" the default directory
ifndef GEOSDIR
GEOSDIR = /home/bmy/Code.v9-02
endif

# Date string DDDHHMM a la "trun"
DATE = `date +%j%H%M`

#=============================================================================
# Makefile targets: type "make help" for a complete list!
#=============================================================================

.PHONY: all geos clean realclean doc docclean help logclean

geos:
	@$(MAKE) -C $(GEOSDIR) 
	cp -f $(GEOSDIR)/bin/geos .
	rm -f log.$(DATE)
	./geos > log.$(DATE) &
	tail -f log.$(DATE)

clean:
	@$(MAKE) -C $(GEOSDIR) clean
	rm -f log*

realclean:
	@$(MAKE) -C $(GEOSDIR) realclean
	rm -f log*

doc:
	@$(MAKE) -C $(GEOSDIR) doc

docclean: 
	@$(MAKE) -C $(GEOSDIR) docclean

help:
	@$(MAKE) -C $(GEOSDIR) help</pre>
</blockquote>
<p align="justify">At the heart of this Makefile are two important blocks of code, the first being:</p>
<blockquote>
  <pre># Make the development version "Code" the default directory
ifndef GEOSDIR
GEOSDIR = /home/bmy/Code.v9-02
endif

# Date string DDDHHMM a la "trun"
DATE = `date +%j%H%M`</pre>
</blockquote>
<p align="justify">This block defines the location of the <a href="chapter_2.html#DownCode">GEOS&ndash;Chem source code directory</a>, which is saved in a variable called <tt>GEOSDIR</tt>.  If a value for <tt>GEOSDIR</tt> is not passed as a command-line argument, then  <tt>GEOSDIR</tt> will be set to <tt>/home/bmy/Code.v9-02</tt> (you can edit this location for your own setup).  Also, a default date/time string is saved in the variable <tt>DATE</tt>. This date/time string will be appended to the GEOS&ndash;Chem log file output.</p>
<p align="justify">The second block of code is used to compile and run the GEOS&ndash;Chem code:</p>
<blockquote><pre>geos:
	@$(MAKE) -C $(GEOSDIR) 
	cp -f $(GEOSDIR)/bin/geos .
	rm -f log.$(DATE)
	./geos > log.$(DATE) &
	tail -f log.$(DATE)</pre>
</blockquote>
<p align="justify">The lines:</p>
<blockquote><pre>	@$(MAKE) -C $(GEOSDIR) 
	cp -f $(GEOSDIR)/bin/geos .</pre>
</blockquote>

<p align="justify">tell <a href="http://www.gnu.org/software/make/" target="_new">GNU Make</a> to call down to the <em>router</em> makefile in the GEOS&ndash;Chem source code directory <tt>/home/bmy/Code.v9-02</tt>. GNU Make will  compile GEOS&ndash;Chem and create the executable file <tt>/home/bmy/Code.v9-02/bin/geos</tt>. This file is then copied to the run directory.</p>
<p align="justify">The next 3 lines:</p>
<blockquote>	
  <pre>	rm -f log.$(DATE)
	./geos > log.$(DATE) &
	tail -f log.$(DATE)</pre>
</blockquote>

<p align="justify">removes the log file (if it already exists), runs the GEOS&ndash;Chem executable (thus starting the simulation), and follows the log file output wit the Unix <tt>tail -f</tt> command.</p>
<p align="justify">For more information, please see:</p>
<ul>
  <li><a href="http://www.gnu.org/software/make/manual/make.html" target="_new" align="justify">GNU Make manua</a>l</li>
  <li>Chapter 6: <a href="chapter_6.html" align="justify">Running GEOS&ndash;Chem</a></li>
</ul>
<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>

<p align="center"><span class="size14bi"><a href="chapter_2.html">Previous</a>
| <a href="chapter_4.html">Next</a> | <a href="chapter_3.html" target="_parent">Printable View
(no frames)</a></span> </p>

</body></html>
