<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>GEOS&#8211;Chem Online User's Guide</title>






<link rel="stylesheet" type="text/css" href="../../../gc.css"><!-- Cascading style sheet for font declarations -->

<style type="text/css">
<!--
th{ font-family : Arial, Helvetica, sans-serif; font-weight : bold; font-size : 16px; text-align : left;
background-color : #CCCCCC; }
td{ font-family : Arial, Helvetica, sans-serif; font-size : 16px; text-align : left;
}
--> </style></head><body style="background-color: rgb(255, 255, 255);">
<script type="text/javascript" src="../../../geos_backlinks.js"></script>
<!-- JavaScript for breadcrumb links -->
<p class="size20bi" align="center">GEOS&#8211;Chem
v8&#8211;03&#8211;01 Online User's Guide</p>
<p class="size14bi" align="center"><a href="chapter_6.html">Previous</a> | <a href="chapter_8.html">Next</a> | <a href="chapter_7.html" target="_parent">Printable View
(no frames)</a><br>
<span class="size16bi"></span></p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size24bi"><a name="7"></a>7.
Coding and Debugging</p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size20bi"><a name="7.1"></a>7.1
Coding: Practice and Style </p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size18bi"><a name="7.1.1"></a>7.1.1
GEOS&#8211;Chem program units</p>
<p align="justify">The GEOS&#8211;Chem source code is written in
Fortran&#8211;90 and contains three different types of program units:</p>
<ol>
<li>
<p align="justify">Traditional subroutines and
functions (<span class="courier16">*.f</span>).
These are compiled individually. One subroutine or function is included
per file.</p>
</li>
<li>
<p align="justify">Header files (<span class="courier16">*.h, CMN*</span>). These files are
not compiled, but are inlined into other program units via the <span class="courier16">#include</span>
C-preprocessor statement. This is a consistent way of importing global
common blocks and parameters into several subroutines or functions at
once. From version 8-02-03, all header files are in the Headers/ subdirectory of the code directory.<br>
</p>
</li>
<li>
<p align="justify">Fortran-90 Modules (<span class="courier16">*_mod.f</span>).
The module construct allows you to bundle several global variables and
routines into one logical package, which can then be used by other
program units. Also, with modules you may define dynamically
allocatable arrays, which are necessary to conserve memory. Much of the
newer GEOS&#8211;Chem code has been written in module form.</p>
<p align="justify">Note:<span class="courier16">
tpcore_fvdas_mod.f90 </span>is the sole exception to the
above-mentioned naming convention, since it ends with a <span class="courier16">*.f90</span> extension. This denotes
that it is written in free-format Fortran-90 code. Module<span class="courier16"> tpcore_fvdas_mod.f90 </span>is
third-party software from S-J Lin at GSFC.</p>
</li>
</ol>
<p align="justify"> The Makefiles (cf. <a href="chapter_3.html#3.3">Chapter 3.3: Compiling the
GEOS&#8211;Chem source code</a>)
that are provided with GEOS&#8211;Chem determine the sequence in which
individual program units will be compiled. To allow the <tt>make</tt>
command to determine the order of compilation and to compile the code
on multi-processors, each routine is listed in the Makefiles with the
module referenced by it (see section <a href="#7.1.3">List of GEOS&#8211;Chem Modules</a> for more information).<br>
</p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size18bi"><a name="7.1.2"></a>7.1.2
Fortran Programming Style</p>
<p align="justify">We have attempted to create <a href="appendix_7.html">a clear and consistent programming
style for GEOS&#8211;Chem subroutines and modules</a>. Some of our
style points include:</p>
<ul class="disc">
<li>
<p>Identification tag line for CVS archive</p>
</li>
<li>
<p>Routine
header detailing original release date, most recent modification date,
list of arguments as input/output, and modification history in ProTeX format.
</p>
</li>
<li>
<p>References to other variables or routines contained within
Fortran-90 modules</p>
</li>
<li>
<p>Use of <span class="courier16">IMPLICIT NONE</span>
to force explicit declaration of all variables</p>
</li>
<li>
<p>Header files in-lined via the C-preprocessor <span class="courier16">#include</span> facility</p>
</li>
<li>
<p>Comments aligned with mode -- major sections denoted by <span class="courier16">!=====</span></p>
</li>
<li>
<p>Copious use of white space to enhance readability</p>
</li>
<li>
<p>Indentation of <span class="courier16">IF-THEN-ELSE</span>
and <span class="courier16">DO-ENDDO</span> blocks</p>
</li>
<li>
<p>OpenMP parallel DO-loops</p>
</li>
</ul>
<p align="justify">When making upgrades to the code, it is
good
practice to block off the section that you are replacing with comments,
and label that as<span class="courier16"> Prior to
MM/DD/YY.</span> Then later on, when the upgraded code has been
declared stable, you can remove the blocked-off section.</p>
<p align="justify">For more information, please be sure to
read <a href="appendix_7.html">Appendix 7: GEOS&#8211;Chem
Style Guide</a>, as well as the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Machine_issues_%26_portability">floating
point and math issues page </a>on the GEOS&#8211;Chem wiki.</p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size18bi"><a name="7.1.3"></a>7.1.3
List of GEOS&#8211;Chem Modules</p>
<p align="justify">As seen in Chapter 3, the GEOS-Chem distribution is
now ordered in different subdirectories. The aim is to separate core
routines for GEOS-Chem and 3rd party code. Here is a list of the
directories as of version 8-03-01:<br>
</p>
<table style="text-align: left; width: 100%;" border="1" cellpadding="5" cellspacing="0" bordercolor="#000000">
  <tbody>
    <tr>
      <th style="vertical-align: top; background-color: rgb(204, 204, 204);">Directory name<br>
      </th>
      <th style="vertical-align: top; background-color: rgb(204, 204, 204);">Description<br>
      </th>
    </tr>
    <tr>
      <th colspan="2" rowspan="1" style="vertical-align: top; background-color: rgb(153, 153, 153); text-align: center;">Help<br>
      </th>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>help</tt>
      </td>
      <td style="vertical-align: top;">Contains information needed to provide help to compile GEOS-Chem.<br>
Type <tt>make help</tt> to access the help screen. </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>doc</tt></td>
      <td style="vertical-align: top;">After creating the documentation, contains PDF or PS files created from ProTeX headers.</td>
    </tr>
    <tr>
      <th colspan="2" rowspan="1" style="vertical-align: top; background-color: rgb(153, 153, 153); text-align: center;">Core directories<br>
      </th>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>Headers</tt></td>
      <td style="vertical-align: top;">Contains all Header files used by GEOS-Chem.<br>
Header files in this directory <span style="font-style: italic;">can</span> be referenced to by 3rd party code.
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>GeosUtil</tt></td>
      <td style="vertical-align: top;">Contains utility type of routine: read/write bpch format file, manage files logical units....<br>
Modules in this directory <span style="font-style: italic;">can</span> be referenced to by 3rd party code.
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>GeosCore</tt></td>
      <td style="vertical-align: top;">Contains core routines for GEOS-Chem.<br>
Modules in this directory <span style="font-style: italic;">can not</span> be referenced to by 3rd party code.<br>
You have to use input/output argument list.
      </td>
    </tr>
    <tr>
      <th colspan="2" rowspan="1" style="vertical-align: top; background-color: rgb(153, 153, 153); text-align: center;">3rd party codes<br>
      </th>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>GeosTomas</tt></td>
      <td style="vertical-align: top;">Contains specific routines for TOMAS and a copy of all routines from GeosCore that are modified by TOMAS aerosol microphysics.
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>ISORROPIA</tt></td>
      <td style="vertical-align: top;">Contains routines for ISORROPIA II
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>KPP</tt></td>
      <td style="vertical-align: top;">Contains
routines created by KPP pre-processor to use an alternative chemistry
solver in GEOS-Chem for different chemistry mechanisms.
      </td>
    </tr>
    <tr>
      <th colspan="2" rowspan="1" style="vertical-align: top; background-color: rgb(153, 153, 153); text-align: center;"><br>
      </th>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>bin</tt></td>
      <td style="vertical-align: top;">After compilation, contains the executable created by the compilation process
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>lib</tt></td>
      <td style="vertical-align: top;">After compilation, contains archives containing the object files of the routines of GEOS-Chem
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>mod</tt></td>
      <td style="vertical-align: top;">After compilation, contains the <tt>*.mod</tt> files
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>obsolete</tt></td>
      <td style="vertical-align: top;">Contains subroutines or module files that became obsolete
      </td>
    </tr>
  </tbody>
</table>
<p align="justify">The GEOS&#8211;Chem distribution currently
contains
approximately 40 Fortran-90 modules. As discussed above, modules can be
used to include both variables and routines into a single convienient
package. A list of the current modules and their dependencies follows.</p>

<table style="width: 100%;" border="1" bordercolor="#000000" cellpadding="5" cellspacing="0">
<tbody>
<tr valign="top">
<th>Module Name</th>
<th>Purpose</th>
<th>Other Modules Referenced</th>
</tr>
    <tr>
      <th colspan="3" rowspan="1" style="vertical-align: top; background-color: rgb(153, 153, 153); text-align: center;">GeosUtil directory<br>
      </th>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">bpch2_mod.f</span></td>
      <td style="vertical-align: top;"> Contains the routines used to read data from and write
data to binary punch file format (v. 2.0)</td>
      <td style="vertical-align: top;"><tt>error_mod.f<br>
file_mod.f<br>
julday_mod.f</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">charpak_mod.f</span></td>
      <td style="vertical-align: top;"> Contains selected routines from the CHARPAK package
for string manipulation</td>
      <td style="vertical-align: top;">none</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">directory_mod.f</span></td>
      <td style="vertical-align: top;">Contains the directory path variables used by <br>

GEOS&#8211;Chem</td>
      <td style="vertical-align: top;">none</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">error_mod.f</span></td>
      <td style="vertical-align: top;"> Contains error checking subroutines</td>
      <td style="vertical-align: top;"><p><tt>ieee_arithmetic.f</tt><br>
      (Intel Fortran Compiler only)</p></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">file_mod.f</span></td>
      <td style="vertical-align: top;"> Contains file unit numbers and I/O error trapping
routines</td>
      <td style="vertical-align: top;"><tt>error_mod.f</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">grid_mod.f</span></td>
      <td style="vertical-align: top;"> Contains variables and routines for computing grid box
longitudes, latitudes, and surface areas</td>
      <td style="vertical-align: top;"><tt>error_mod.f</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">hdf_mod.f</span><br>
      </td>
      <td style="vertical-align: top;">Contains routines to write data to HDF5 files<br>
      </td>
      <td style="vertical-align: top;"><tt>grid_mod.f</tt><br>
      <tt>error_mod.f</tt><br>
      </td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">julday_mod.f</span></td>
      <td style="vertical-align: top;">Contains routines for converting YYYYMMDD and HHMMSS
to/from
astronomical Julian date. (This allows GEOS&#8211;Chem to handle transitions
such as end-of-month, end-of-year, and end-of-century in a consistent
fashion.)</td>
      <td style="vertical-align: top;">none</td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">pressure_mod.f</span></td>
      <td style="vertical-align: top;">Contains variables and routines which specify the grid
box pressures
for both hybrid or pure-sigma models. This is necessary for running
GEOS&#8211;Chem with the new fvDAS meteorology.</td>
      <td style="vertical-align: top;"><tt>error_mod.f</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">regrid_1x1_mod.f</span></td>
      <td style="vertical-align: top;">Does online regridding of data on the GEOS-Chem 1&deg; x 1&deg;
grid to 1&deg; x 1&deg;, 2&deg; x 2.5&deg;, or 4&deg; x 5&deg; GEOS or GCAP grids.</td>
      <td style="vertical-align: top;"><tt>charpak_mod.f<br>
error_mod.f<br>
grid_mod.f</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">time_mod.f</span></td>
      <td style="vertical-align: top;"> Contains routines for computing date &amp; time
variables</td>
      <td style="vertical-align: top;"><tt>charpak_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
julday_mod.f</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">transfer_mod.f</span></td>
      <td style="vertical-align: top;">Contains routines to compute cast data from REAL*4 to
REAL*8 precision,
and also to regrid GEOS&#8211;3 data from 48 vertical levels to 30 vertical
levels.</td>
      <td style="vertical-align: top;"><tt>error_mod.f<br>
grid_mod.f<br>
pressure_mod.f</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">unix_cmds_mod.f</span></td>
      <td style="vertical-align: top;"> Contains Unix command strings which are used for
unzipping of meteorological data files</td>
      <td style="vertical-align: top;">none</td>
    </tr>
    <tr>
      <th colspan="3" rowspan="1" style="vertical-align: top; background-color: rgb(153, 153, 153); text-align: center;">GeosCore directory<br>
      </th>
    </tr>

<tr valign="top">
<td class="courier16">RnPbBe_mod.f</td>
<td>Contains variables and routines used for the
222Rn-210Pb-7Be-10Be simulation</td>
<td class="courier16"><tt>dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">a3_read_mod.f</td>
<td>Contains routines which unzip, open and read the
GEOS-Chem A-3 fields from disk</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
transfer_mod.f<br>
unix_cmds_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">a6_read_mod.f</td>
<td>Contains routines which unzip, open and read the
GEOS-Chem A-6 fields from disk</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
transfer_mod.f<br>
unix_cmds_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">acetone_mod.f</td>
<td> Contains subroutines to emit the biogenic flux of
acetone into the full chemistry simulation </td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
time_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">aerosol_mod.f</td>
<td>Contains routines which compute aerosol concentrations
(kg/m3) and optical depths.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
comode_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">aircraft_nox_mod.f</td>
<td> Contains arrays and routines to compute aircraft NOx,
emissions for the full chemistry simulation </td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pressure_mod.f<br>
time_mod.f</tt></td>
</tr>
<tr>
<td class="courier16">arctas_ship_emiss_mod.f</td>
<td>Contains variables and routines to read the Arctas Ship
emissions.</td>
<td class="courier16">bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
scale_anthro_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</td>
</tr>
<tr valign="top">
<td class="courier16">benchmark_mod.f</td>
<td>Contains routines to save out tracer masses in kg for
the 1-month fullchem and Rn-Pb-Be benchmark simulations.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
file_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">biofuel_mod.f</td>
<td>Contains arrays and routines to compute monthly biofuel
burning
emissions for NOx, CO, ALK4, ACET, MEK, ALD2, PRPE, C3H8, CH2O, C2H6
CH4, and CH3I </td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
epa_nei_mod.f<br>
error_mod.f<br>
future_emissions_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">biomass_mod.f</td>
<td>Contains arrays and routines to compute monthly biomass
burning
emissions for NOx, CO, ALK4, ACET, MEK, ALD2, PRPE, C3H8, CH2O, C2H6
CH4, and CH3I </td>
<td class="courier16"><tt>diag_mod.f<br>
error_mod.f<br>
gc_biomass_mod.f<br>
gfed2_biomass_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>

<tr valign="top">
<td class="courier16">bravo_mod.f</td>
<td> Contains variables and routines to read the BRAVO
mexican anthropogenic emission inventory.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
tracerid_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">c2h6_mod.f</td>
<td> Contains the variables and routines used to perform a
standalone simulation for ethane </td>
<td class="courier16"><tt>biofuel_mod.f<br>
biomass_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
geia_mod.f<br>
global_oh_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr>
<td class="courier16">cac_anthro_mod.f</td>
<td>Contains variables and routines to&nbsp;read
the&nbsp;Criteria Air Contaminant Canadian anthropogenic emissions</td>
<td class="courier16">bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
scale_anthro_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</td>
</tr>
<tr valign="top">
<td class="courier16">carbon_mod.f</td>
<td>Contains variables and routines for carbon aerosol
emissions and chemistry</td>
<td class="courier16"><tt>biomass_mod.f<br>
bpch2_mod.f<br>
comode_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
drydep_mod.f<br>
error_mod.f<br>
file_mod.f<br>
future_emissions_mod.f<br>
global_no3_mod.f<br>
global_o3_mod.f<br>
global_oh_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
megan_mod.f<br>
pbl_mix_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">ch3i_mod.f</td>
<td> Contains the variables and routines used to perform a
standalone simulation for methyl iodide </td>
<td class="courier16"> <tt>biofuel_mod.f<br>
biomass_mod.f<br>
bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
diag_pl_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
uvalbedo_mod.f</tt></td>
</tr>

<tr valign="top">
<td class="courier16">chemistry_mod.f</td>
<td>Contains a driver program which selects the proper
chemistry routine for the various GEOS&#8211;Chem simulation types</td>
<td class="courier16"><tt>acetone_mod.f<br>
aerosol_mod.f<br>
c2h6_mod.f<br>
carbon_mod.f<br>
ch3i_mod.f<br>
dao_mod.f<br>
drydep_mod.f<br>
dust_mod.f<br>
error_mod.f<br>
global_ch4_mod.f<br>
h2_hd_mod.f<br>
hcn_ch3cn_mod.f<br>
isoropia_mod.f<br>
kr85_mod.f<br>
logical_mod.f<br>
mercury_mod.f<br>
optdepth_mod.f<br>
rpmares_mod.f<br>
rnpbbe_mod.f<br>
seasalt_mod.f<br>
sulfate_mod.f<br>
tagged_co_mod.f<br>
tagged_ox_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">co2_mod.f</td>
<td>Contains variables and routines used for the CO2
simulation</td>
<td class="courier16"><tt>biomass_mod.f<br>
bpch2_mod.f<br>
diag04_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
time_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">comode_mod.f</td>
<td> Contains allocatable arrays for SMVGEAR that were
previously contained in common blocks in header file "comode.h" </td>
<td class="courier16"><tt>error_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">convection_mod.f</td>
<td>Contains routines which select the proper convection
code for GEOS&#8211;1, GEOS&#8211;STRAT, GEOS&#8211;3 or GEOS&#8211;4 met data sets</td>
<td class="courier16">d<tt>dao_mod.f<br>
diag_mod.f<br>
error_mod.f<br>
fvdas_convect_mod.f<br>
gcap_convect_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
ocean_mercury_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
wetscav_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">dao_mod.f</td>
<td>Contains arrays that hold DAO met fields, as well as
subroutines that
compute, interpolate, or otherwise process DAO met field data </td>
<td class="courier16"><tt>error_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag03_mod.f</td>
<td>Contains arrays and routines for archiving the ND03
diagnostic&#8212;Hg emissions, mass, and production.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
time_mod.f<br>
tracerid_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag04_mod.f</td>
<td>Contains arrays and routines for archiving the ND04
diagnostic -- CO2 emissions and fluxes</td>
<td class="courier16"><tt>bpch2_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
time_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag41_mod.f</td>
<td>Contains arrays and routines for archiving the
ND41diagnostic&#8212;Afternoon PBL heights</td>
<td class="courier16"><tt>bpch2_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pbl_mix_mod.f<br>
time_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag42_mod.f</td>
<td> Contains arrays and routines for archiving the ND41
diagnostic -- Afternoon PBL heights.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag48_mod.f</td>
<td>Contains variables and routines to save timeseries data
at particular lat/lon locations.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag49_mod.f</td>
<td>Contains variables and routines to save instantaneous
timeseries data to disk for a 3-D subset of the globe.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag50_mod.f</td>
<td>Contains variables and routines to save instantaneous
timeseries data to disk for a 3-D subset of the globe.</td>
<td class="courier16"> <tt>bpch2_mod.f<br>
dao_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag51_mod.f</td>
<td>Contains variables and routines to save timeseries data
over the United
States where the local time is between two user-defined limits. This is
useful for comparing with sun-synchronous satellites such as GOME.</td>
<td class="courier16"> <tt>bpch2_mod.f<br>
dao_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
    <tr>
      <td style="vertical-align: top;"><span class="courier16">diag51b_mod.f</span></td>
      <td style="vertical-align: top;">Contains similar variables and routines as <tt>diag51_mod.f</tt> to allow to follow two satellite tracks at a time.<br>
      </td>
      <td style="vertical-align: top;"><tt>bpch2_mod.f<br>
dao_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
tropopause_mod.f</tt></td>
    </tr>
<tr valign="top">
<td class="courier16">diag56_mod.f</td>
<td> Contains arrays and routines for archiving the ND56
diagnostic -- lightning flash rates.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
time_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag_mod.f</td>
<td> Contains declarations for allocatable arrays for use
with GEOS&#8211;Chem diagnostics and other routines </td>
<td class="courier16">none</td>
</tr>
<tr valign="top">
<td class="courier16">diag_oh_mod.f</td>
<td>Contains routines to compute the Mean OH diagnostic for
a full chemistry simulation.</td>
<td class="courier16"> <tt>comode_mod.f<br>
error_mod.f<br>
logical_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">diag_pl_mod.f</td>
<td>Contains routines to compute chemical production for
tracers. </td>
<td class="courier16"> <tt>bpch2_mod.f<br>
charpak_mod.f<br>
comode_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>

<tr valign="top">
<td class="courier16">drydep_mod.f</td>
<td>Contains variables and routines to compute dry
deposition velocities and frequencies</td>
<td class="courier16"><tt>comode_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pbl_mix_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">dust_dead_mod.f</td>
<td>Contains
routines and variables from Charlie Zender's DEAD dust mobilization
model. Most routines are from Charlie Zender, but have been modified
and/or cleaned up for inclusion into GEOS-Chem. </td>
<td class="courier16"> <tt>bpch2_mod.f<br>
dao_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
time_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">dust_mod.f</td>
<td>Contains routines for computing dust aerosol emissions,
chemistry, and optical depths.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
comode_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
drydep_mod.f<br>
dust_dead_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">edgar_mod.f</td>
<td> Contains variables and routines to read the EDGAR
global anthropogenic emission inventory.</td>
<td class="courier16">
<p><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
future_emissions_mod.f grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
time_mod.f </tt></p>
</td>
</tr>
<tr valign="top">
<td class="courier16">emep_mod.f</td>
<td>Contains
variables and routines to read the EMEP European anthropogenic emission
inventory for CO, NOz, and some NMVOCs. The EMEP files come from Marion
Auvray and Isabelle Bey at EPFL. </td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">emissions_mod.f</td>
<td> Contains a driver program which selects the proper
emissions subroutine for the various GEOS&#8211;Chem simulation types. </td>
<td class="courier16"><tt>biomass_mod.f<br>
bravo_mod.f<br>
c2h6_mod.f<br>
carbon_mod.f<br>
ch3i_mod.f<br>
co2_mod.f<br>
dust_mod.f<br>
edgar_mod.f<br>
emep_mod.f<br>
epa_nei_mod.f<br>
error_mod.f<br>
global_ch4_mod.f<br>
h2_hd_mod.f<br>
hcn_ch3cn_mod.f<br>
kr85_mod.f<br>
logical_mod.f<br>
mercury_mod.f<br>
rnpbbe_mod.f<br>
seasalt_mod.f<br>
streets_anthro_mod.f<br>
sulfate_mod.f<br>
tagged_co_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">epa_nei_mod.f</td>
<td>Contains variables and routines to read the
weekday/weekend emissions from the EPA/NEI emissions inventory.</td>
<td class="courier16"> <tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>


<tr>
<td class="courier16">fjx_acet_mod.f</td>
<td>Contains functions for pressure dependency for Acetone
photolysis from FAST-JX </td>
<td class="courier16">none</td>
</tr>
<tr valign="top">
<td class="courier16">future_emissions_mod.f</td>
<td>Contains variables and routines for returning scale
factors for IPCC A1
&amp; B1 emissions scenarios for future years such as 2030, 2050,
etc.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">fvdas_convect_mod.f</td>
<td>
<p>Contains
routines (originally from NCAR) which perform shallow and deep
convection for the GEOS&#8211;4 met fields. These routines account for
shallow and deep convection, updrafts, and downdrafts.</p>
</td>
<td class="courier16"><tt>diag_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
ocean_mercury_mod.f<br>
pressure_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">gamap_mod.f</td>
<td>Contains
routines to create GAMAP "tracerinfo.dat" and "diaginfo.dat" files
which are customized to each particular GEOS-Chem simulation.</td>
<td class="courier16"><tt>diag03_mod.f<br>
diag04_mod.f<br>
diag41_mod.f<br>
diag42_mod.f<br>
diag48_mod.f<br>
diag49_mod.f<br>
diag50_mod.f<br>
diag51_mod.f<br>
diag56_mod.f<br>
diag_pl_mod.f<br>
drydep_mod.f<br>
error_mod.f<br>
file_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
wetscav_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">gc_biomass_mod.f</td>
<td>Contains arrays and routines to compute monthly biomass
burning
emissions for NOx, CO, ALK4, ACET, MEK, ALD2, PRPE, C3H8, CH2O, C2H6,
CH4, and CH3I.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">gcap_convect_mod.f</td>
<td>Contains routines (originally from GISS) which perform
shallow and deep convection for the GCAP met fields.</td>
<td class="courier16"><tt>dao_mod.f<br>
diag_mod.f<br>
grid_mod.f<br>
pressure_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">gcap_read_mod.f</td>
<td> Contains subroutines that unzip, open, and read the
GCAP PHIS and LWI_GISS fields from disk.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
transfer_mod.f<br>
unix_cmds_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">geia_mod.f</td>
<td> Contains routines used to read and scale the
GEIA/Piccot fossil fuel emissions for NOx, CO, and hydrocarbons </td>
<td class="courier16"> <tt>bpch2_mod.f<br>
directory_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
time_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">gfed2_biomass_mod.f</td>
<td> Contains variables and routines to compute the GFED2
biomass burning emissions.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">global_ch4_mod.f</td>
<td> Contains variables and routines for simulating CH4
chemistry in the troposphere </td>
<td class="courier16"><tt> bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
diag_oh_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">global_hno3_mod.f</td>
<td>Contains variables and routines for reading in monthly
mean HNO3 concentrations for the offline sulfate simulation</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">global_no3_mod.f</td>
<td>Contains variables and routines for reading in global
monthly mean NO3 concentrations (used for the offline sulfate
simulation)</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">global_nox_mod.f</td>
<td>Contains variables and routines for reading the global
monthly mean NOx
concentration from disk (used for the offline sulfate simulation) </td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
transfer_mod.f<br>
unix_cmds_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">global_o1d_mod.f</td>
<td>Contains variables and routines for reading the global
monthly mean O1D
stratospheric concentration from disk. This is used in the H2/HD
simulation. The O1D fields were obtained from Gabriele Curci GEOS-Chem
simulation in the stratosphere (v5.03).</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">global_o3_mod.f</td>
<td>Contains variables and routines for reading the global
monthly mean O3 concentration from disk </td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">global_oh_mod.f</td>
<td> Contains variables and routines for reading the global
monthly mean OH concentration from disk </td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
transfer_mod.f</tt></td>
</tr>

<tr valign="top">
<td class="courier16">gwet_read_mod.f</td>
<td>Contains routines which unzip, open and read the
GEOS-Chem GWET fields from disk.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
transfer_mod.f<br>
unix_cmds_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">h2_hd_mod.f</td>
<td> Contains variables and routines used for the H2-HD
simulation.</td>
<td class="courier16"><tt>biofuel_mod.f<br>
biomass_mod.f<br>
bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
drydep_mod.f<br>
error_mod.f<br>
geia_mod.f<br>
global_nox_mod.f<br>
global_o1d_mod.f<br>
global_oh_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
tagged_co_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">hcn_ch3cn_mod.f</td>
<td>Contains variables and routines that are used for the
geographically tagged HCN/CH3CN simulation.</td>
<td class="courier16"><tt>biomass_mod.f<br>
bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
geia_mod.f<br>
global_oh_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pbl_mix_mod.f<br>
time_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">i6_read_mod.f</td>
<td>Contains routines which unzip, open and read the
GEOS-Chem I-6 fields from disk</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
transfer_mod.f<br>
tropopause_mod.f<br>
unix_cmds_mod.f</tt></td>
</tr>
    <tr>
      <td style="vertical-align: top;"><tt>icoads_ship_mod.f</tt></td>
      <td style="vertical-align: top;">Contains
variables and routines to read the International Comprehensive
Ocean-Atmosphere Data Set (ICOADS) ship emissions. Base year is 2002.<br>
      </td>
      <td style="vertical-align: top;">tracer_mod.f<br>
tracerid_mod.f<br>
time_mod.f<br>
      <br>
      </td>
    </tr>
<tr valign="top">
<td class="courier16">input_mod.f</td>
<td>
<p>Contains
routines which read information from the new input.geos file and pass
it to the various initialization routines of GEOS-Chem modules.</p>
<p>NOTE: This module needs to be compiled last, as it
references many other modules.</p>
</td>
<td class="courier16"><tt>benchmark_mod.f<br>
biofuel_mod.f<br>
biomass_mod.f<br>
bpch2_mod.f<br>
charpak_mod.f<br>
diag03_mod.f<br>
diag04_mod.f<br>
diag41_mod.f<br>
diag42_mod.f<br>
diag48_mod.f<br>
diag49_mod.f<br>
diag50_mod.f<br>
diag51_mod.f<br>
diag56_mod.f<br>
diag_oh_mod.f<br>
diag_pl_mod.f<br>
directory_mod.f<br>
drydep_mod.f<br>
error_mod.f<br>
file_mod.f<br>
future_emissions_mod.f<br>
gamap_mod.f<br>
grid_mod.f<br>
julday_mod.f<br>
logical_mod.f<br>
mercury_mod.f<br>
ocean_mercury_mod.f<br>
planeflight_mod.f<br>
restart_mod.f<br>
time_mod.f<br>
tpcore_bc_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
transport_mod.f<br>
unix_cmds_mod.f<br>
upbdflx_mod.f<br>
wetscav_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">isoropiaII_mod.f</td>
<td>Contains the routines from the ISORROPIAII package, which
performs aerosol thermodynamical equilibrium</td>
<td class="courier16"><tt>dao_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
global_hno3_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>

<tr valign="top">
<td class="courier16">lai_mod.f</td>
<td>Reads and stores AVHRR LAI for calculating MEGAN
biogenic VOC emissions.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
regrid_1x1_mod.f<br>
time_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">lightning_nox_mod.f</td>
<td>Contains
variables and routines for emitting NOx from lightning into the
atmosphere. The original code comes from the old GISS-II CTM's of
Yuhang Wang, Gerry Gardner, &amp; Larry Horowitz. Cleaned up for
inclusion into GEOS-Chem.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag56_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
transfer_mod.f</tt></td>
</tr>
    <tr>
      <td style="vertical-align: top;"><tt>linoz_mod.f</tt></td>
      <td style="vertical-align: top;">Contains routines to perform the Linoz stratospheric ozone chemistry.<br>
      </td>
      <td style="vertical-align: top;"><tt>dao_mod.f<br>
directory_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f<br>
tracerid_mod.f<br>
tropopause_mod.f</tt></td>
    </tr>
<tr valign="top">
<td class="courier16">logical_mod.f</td>
<td>Contains all of the logical switches used by GEOS-Chem.</td>
<td class="courier16">none</td>
</tr>
<tr valign="top">
<td class="courier16">megan_mod.f</td>
<td>Contains variables and routines specifying the
algorithms that control the MEGAN inventory of biogenic emissions.</td>
<td class="courier16"><tt>a3_read_mod.f<br>
bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
julday_mod.f<br>
lai_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
time_mod.f</tt></td>
</tr>
    <tr>
      <td style="vertical-align: top;"><tt>meganut_mod.f</tt></td>
      <td style="vertical-align: top;">Contains functions used by MEGAN and other routines<br>
      </td>
      <td style="vertical-align: top;"><tt>dao_mod.f</tt></td>
    </tr>
<tr valign="top">
<td class="courier16">mercury_mod.f</td>
<td>Contains variables and routines for the GEOS&#8211;Chem
mercury simulation. </td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag03_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
drydep_mod.f<br>
error_mod.f<br>
global_o3_mod.f<br>
global_oh_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
ocean_mercury_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
regrid_1x1_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
    <tr>
      <td style="vertical-align: top;"><tt>nei2005_anthro_mod.f</tt>
      </td>
      <td style="vertical-align: top;">Contains variables and routines to read the NEI2005 anthropogenic emissions<br>
      </td>
      <td style="vertical-align: top;"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
scale_anthro_mod.f<br>
time_mod.f<br>
tracer_mod.f<br>
tracerid_mod.f</tt>
      </td>
    </tr>
<tr valign="top">
<td class="courier16">ocean_mercury_mod.f</td>
<td>Contains variables and routines needed to compute the
oceanic flux of mercury. Original code by Sarah Strode at UWA/Seattle.</td>
<td class="courier16"><tt> bpch2_mod.f<br>
dao_mod.f<br>
diag03_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">optdepth_mod.f</td>
<td> Contains routines to compute optical depths for
GEOS&#8211;1, GEOS&#8211;STRAT, GEOS&#8211;2, and GEOS&#8211;3 met data sets </td>
<td class="courier16"><tt>diag_mod.f<br>
</tt></td>
</tr>
<tr valign="top">
<td class="courier16">pbl_mix_mod.f</td>
<td>Contains
routines and variables used to compute the planetary boundary layer
(PBL) height and to mix tracers underneath the PBL top.</td>
<td class="courier16"><tt>dao_mod.f<br>
diag_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr>
<td class="courier16">pjc_pfix_geos5_window_mod.f</td>
<td>Contains
routines which implements the&nbsp;Philip Cameron-Smith pressure
fixer.
Specially modified for the GEOS-5 nested grid simulation.</td>
<td class="courier16">error_mod.f<br>
grid_mod.f<br>
pressure_mod.f</td>
</tr>
<tr valign="top">
<td class="courier16">pjc_pfix_mod.f</td>
<td>Contains variables and routines which implement the
Philip
Cameron-Smith pressure fixer for the new GEOS&#8211;4/TPCORE transport code
(contained in tpcore_fvdas_mod.f90).</td>
<td class="courier16"><tt>error_mod.f<br>
grid_mod.f<br>
pressure_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">planeflight_mod.f</td>
<td>Contains variables and routines which are used to "fly"
a plane through
the GEOS&#8211;Chem model simulation. This is useful for comparing model
results with aircraft observations. </td>
<td class="courier16"><tt>bpch2_mod.f<br>
comode_mod.f<br>
dao_mod.f<br>
error_mod.f<br>
file_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>


<tr valign="top">
<td class="courier16">restart_mod.f</td>
<td>Contains variables and routines which are used to read
and write
GEOS&#8211;Chem restart files, which contain tracer concentrations in [v/v]
mixing ratio. </td>
<td class="courier16"><tt>bpch2_mod.f<br>
charpak_mod.f<br>
dao_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">rpmares_mod.f</td>
<td>Contains variables and routines to compute aerosol
thermodynamic equilibrium</td>
<td class="courier16"><tt>dao_mod.f<br>
error_mod.f<br>
global_hno3_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
<tr>
<td class="courier16">scale_anthro_mod.f</td>
<td>Contains routines to scale&nbsp;anthropogenic
emissions from a base year to a simulation year.</td>
<td class="courier16">bpch2_mod.f<br>
directory_mod.f<br>
regrid_1x1_mod.f</td>
</tr>
<tr valign="top">
<td class="courier16">seasalt_mod.f</td>
<td>Contains
arrays and routines for performing either a coupled chemistry/aerosol
run or an offline seasalt aerosol simulation. The original code taken
from Mian Chin's GOCART model and was modified accordingly for
GEOS&#8211;Chem. <br>
</td>
<td class="courier16"><tt>dao_mod.f<br>
diag_mod.f<br>
drydep_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
    <tr>
      <td style="vertical-align: top;"><tt>soaprod_mod.f</tt></td>
      <td style="vertical-align: top;">Contains variables and routines which are used to read and write APROD and GPROD restart files for SOA simulations.<br>
      </td>
      <td style="vertical-align: top;"><tt>bpch2_mod.f<br>
carbon_mod.f<br>
dao_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
    </tr>
<tr valign="top">
<td class="courier16">streets_anthro_mod.f</td>
<td> Contains variables and routines to read the David
Streets et al Asian anthropogenic emissions.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">sulfate_mod.f</td>
<td> Contains the sulfate chemistry routines from Mian
Chin's GOCART model and updated routines. </td>
<td class="courier16"> <tt>biomass_mod.f<br>
bpch2_mod.f<br>
bravo_mod.f<br>
comode_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
drydep_mod.f<br>
edgar_mod.f<br>
epa_nei_mod.f<br>
error_mod.f<br>
file_mod.f<br>
future_emissions_mod.f<br>
global_hno3_mod.f<br>
global_no3_mod.f<br>
global_oh_mod.f<br>
grid_mod.f<br>
isoropia_mod.f<br>
logical_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
regrid_1x1_mod.f<br>
seasalt_mod.f<br>
streets_anthro_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
tropopause_mod.f<br>
uvalbedo_mod.f<br>
wetscav_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">tagged_co_mod.f</td>
<td> Contains variables and routines used for the
geographically tagged CO simulation </td>
<td class="courier16"><tt>biofuel_mod.f<br>
biomass_mod.f<br>
bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
diag_pl_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
geia_mod.f<br>
global_nox_mod.f<br>
global_oh_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">tagged_ox_mod.f</td>
<td>Contains
variables and routines to perform a tagged Ox simulation. P(Ox) and
L(Ox) rates need to be archived from a full chemistry simulation before
you can run w/ Tagged Ox.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
diag_pl_mod.f<br>
directory_mod.f<br>
drydep_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pbl_mix_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>

<tr valign="top">
<td class="courier16">toms_mod.f</td>
<td> Contains variables and routines for reading the
EP-TOMS O3 column data from disk (for use w/ the FAST&#8211;J photolysis
routines)</td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
time_mod.f<br>
transfer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">tpcore_bc_mod.f</td>
<td>Contains variables and routines to read and write
boundary conditions
from a global simulation. These are needed for TPCORE transport for
nested grid 1 x 1 simulations. </td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">tpcore_fvdas_mod.f90</td>
<td>Contains routines for the TPCORE transport scheme, as
implemented in the GMI model, based on Lin&nbsp;Rood 1995.</td>
<td class="courier16">none</td>
</tr>
<tr>
<td>
<pre class="courier16">tpcore_geos5_window_mod.f90</pre>
</td>
<td>Contains routines for the
GEOS-4/fvDAS&nbsp;transport scheme.&nbsp; Original code from
S-J Lin and Kevin Yeh.</td>
<td class="courier16">none</td>
</tr>
<tr valign="top">
<td class="courier16">tpcore_mod.f</td>
<td>Contains the TPCORE transport subroutine package by S-J
Lin, version
7.1. Also contains the pressure fixer routines for TPCORE from M.
Prather (in versions 4.21 and higher). </td>
<td class="courier16"><tt>dao_mod.f<br>
diag_mod.f<br>
global_ch4_mod.f<br>
grid_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">tpcore_window_mod.f</td>
<td> Contains the TPCORE transport subroutine package by
S-J Lin, version 7.1, modified for nested-grid simulations by Yuxuan
Wang.</td>
<td class="courier16"><tt>dao_mod.f<br>
diag_mod.f<br>
global_ch4_mod.f<br>
grid_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">tracer_mod.f</td>
<td>Contains
the GEOS-Chem tracer array STT plus various other related quantities.
TRACER_MOD also contains inquiry functions that can be used to
determine the type of GEOS-Chem simulation.</td>
<td class="courier16"><tt>error_mod.f<br>
</tt></td>
</tr>
<tr valign="top">
<td class="courier16">tracerid_mod.f</td>
<td>Contains variables and routines used to identify
tracers, emission species, biomass burning species, and biofuel burning
species</td>
<td class="courier16"><tt>charpak_mod.f<br>
error_mod.f<br>
logical_mod.f<br>
tracer_mod.f</tt></td>
</tr>

<tr valign="top">
<td class="courier16">transport_mod.f</td>
<td>Contains routines which select the proper transport
routines for GEOS&#8211;Chem global and window simulations.</td>
<td class="courier16"><tt>dao_mod.f<br>
diag_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pjc_pfix_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tpcore_bc_mod.f<br>
tpcore_fvdas_mod.f<br>
tpcore_mod.f<br>
tpcore_window_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">tropopause_mod.f</td>
<td>Contains routines and variables for reading and
returning the value of the annual mean tropopause.</td>
<td class="courier16"><tt> bpch2_mod.f<br>
comode_mod.f<br>
dao_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
transfer_mod.f</tt></td>
</tr>

<tr valign="top">
<td class="courier16">upbdflx_mod.f</td>
<td>Contains subroutines which impose stratospheric
boundary conditions on O3 and NOy </td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
logical_mod.f<br>
pressure_mod.f<br>
tagged_ox_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f<br>
transfer_mod.f<br>
tropopause_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">uvalbedo_mod.f</td>
<td>Contains variables and routines for reading the UV
Albedo data from disk (for use w/ the FAST&#8211;J photolysis routines). </td>
<td class="courier16"><tt>bpch2_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
transfer_mod.f</tt></td>
</tr>
    <tr>
      <td style="vertical-align: top;"><tt>vdiff_mod.f</tt></td>
      <td style="vertical-align: top;">Contains all routines for the non-local PBL mixing scheme.<br>
      </td>
      <td style="vertical-align: top;"><tt>comode_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
drydep_mod.f<br>
error_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
pbl_mix_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracer_mod.f<br>
vdiff_pre_mod.f</tt></td>
    </tr>
    <tr>
      <td style="vertical-align: top;"><tt>vdiff_prep_mod.f</tt></td>
      <td style="vertical-align: top;">Contains variables used in vdiff_mod.f<br>
      </td>
      <td style="vertical-align: top;"><tt>tracer_mod.f</tt></td>
    </tr>
<tr>
<td class="courier16">vistas_anthro_mod.f</td>
<td>Contains variables and routines&nbsp;to read
the&nbsp;VISTAS anthropogenic emissions.</td>
<td class="courier16">bpch2_mod.f<br>
directory_mod.f<br>
epa_nei_mod.f<br>
error_mod.f<br>
future_emissions_mod.f<br>
grid_mod.f<br>
logical_mod.f<br>
regrid_1x1_mod.f<br>
scale_anthro_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</td>
</tr>
<tr valign="top">
<td class="courier16">wetscav_mod.f</td>
<td> Contains arrays for used in the wet scavenging of
tracer in cloud updrafts, rainout, and washout </td>
<td class="courier16"><tt>dao_mod.f<br>
diag_mod.f<br>
error_mod.f<br>
logical_mod.f<br>
ocean_mercury_mod.f<br>
pressure_mod.f<br>
time_mod.f<br>
tracerid_mod.f<br>
tracer_mod.f</tt></td>
</tr>
<tr valign="top">
<td class="courier16">xtra_read_mod.f</td>
<td>Contains routines that unzip, open, and read the
GEOS-Chem XTRA (avg 3-hour) met fields from disk.</td>
<td class="courier16"><tt>bpch2_mod.f<br>
dao_mod.f<br>
diag_mod.f<br>
directory_mod.f<br>
error_mod.f<br>
file_mod.f<br>
logical_mod.f<br>
time_mod.f<br>
transfer_mod.f<br>
unix_cmds_mod.f</tt></td>
</tr>
</tbody>
</table>
<p><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size18bi"><a name="7.1.4"></a>7.1.4
Compilation Sequence for GEOS&#8211;Chem<br>
</p>
<p align="justify">The different subdirectories of the Code directory are compiled in the following order:</p>
<blockquote>
<pre>KPP/
GeosUtil/
ISOROPIA/
GeosCore/</pre>
</blockquote>
<p align="justify">In each subdirectory, there is a Makefile listing all files(functions, subroutines and modules) and the dependencies of each file.</p>
<p align="justify">For subroutines, functions or modules which do not refer to other modules, only the file itself is listed in the dependencies, e.g.</p>
<blockquote>
<pre>decomp.o                     : decomp.f</pre>
</blockquote>
<p align="justify">When there are references to other modules in the file (through USE statement), you need to list the file itself and all other modules from
the same directory it refers to. E.g: from the table in <a href="#7.1.3">List of GEOS&#8211;Chem Modules</a>, tropopause_mod.f refers to 8 other modules but only 3 are in GeosCore, so in the Makefile you write:<br>
</p>

<blockquote>
<pre>tropopause_mod.o             : tropopause_mod.f          \
                               comode_mod.o   dao_mod.o  \
                               logical_mod.o</pre>
</blockquote>
<p align="justify">The order of the list of files is not important. The make utility defines the order of compilation by itself. Thus we maintain an
alphabetical order of the files.</p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size20bi"><a name="7.1.5"></a>7.1.5
OpenMP parallel loop directives </p>
<p align="justify">In the late 1990's, a new open
standard for parallel computing named <a href="http://www.openmp.org" target="_blank">OpenMP</a> was developed by several compiler vendors, including Sun, SGI, Compaq,
and Microsoft. The resulting standard allows parallel processing source
code (written in either Fortran or C) to be ported between different
platforms with minimal effort. As of version 4.17, all GEOS&#8211;Chem
parallel DO loops have been converted to the new OpenMP standard. </p>
<p align="justify"> Here is an example DO loop written using OpenMP parallel directives: </p>
<blockquote>
<pre>Column   1         2         3         4
1234567890123456789012345678901234567890
!$OMP PARALLEL DO
!$OMP+SHARED( A )
!$OMP+PRIVATE( I, J )
!$OMP+SCHEDULE( DYNAMIC )
      DO J = 1, JJPAR
      DO I = 1, IIPAR
	     A(I,J) = A(I,J) * 2.0
      ENDDO
      ENDDO
!$OMP END PARALLEL DO</pre>
</blockquote>
<p align="justify"> You may also have noticed that the
first column in each line of the <span class="courier16">!$OMP PARALLEL DO</span>
directives begin with a legal Fortran comment character (either <span class="courier16">C</span> or <span class="courier16">!</span>).
This is by design. In order to invoke the parallel procesing commands,
you must turn on a specific switch in your makefile (this is <span class="courier16">-mp</span>
for SGI; check your compiler manual for other platforms). If you do not
specify multiprocessor compilation, then the parallel processing
directives will be considered as Fortran comments, and the associated
DO-loops will be executed on one processor only. Also, since GEOS&#8211;Chem
uses the traditional "fixed-form" Fortran style, the <span class="courier16">!$OMP</span> commands must begin at
column 1. Otherwise a syntax error will result at compile time. </p>
<p align="justify"> It should be noted that OpenMP
commands are not
the same as MPI (message passing interface). With OpenMP directives,
you are able to split a job among several processors on the same
machine. You are NOT able to split a job among several processors on
different machines. Therefore, OpenMP is not suitable for Beowulf-style
architectures. We are working on porting GEOS&#8211;Chem to distributed style
architectures. </p>
<p align="justify">For more information about OpenMP,
consult the web site <a href="http://www.openmp.org" target="_blank">OpenMP.org</a>.</p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size20bi"><a name="7.2"></a>
7.2 GEOS&#8211;Chem Debugging</p>
<p align="justify"> GEOS&#8211;Chem is an evolving model. <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/GEOS-Chem_versions_under_development" target="_blank">New
features and functionalities</a> are constantly being added to it
by <a href="../../../geos_people.html" target="_blank">a
rapidly increasing group of users</a>. As with any software
project, mistakes are inevitable.</p>
<p align="justify"> Most of the bugs you you will
encounter when working on GEOS&#8211;Chem will fall into one of two
categories:</p>
<ol>
<li>
<p align="justify">True bugs: typos, omissions,
reading the wrong file, or other outright mistakes. </p>
</li>
<li>
<p align="justify">Design
limitation bugs: that is, writing code in such a way that will make it
difficult or impossible to extend the functionality of the model at
some future time. </p>
</li>
</ol>
<p align="justify">Bugs of the first category are, in
general, easily
rectified. The fixes to these bugs typically involve either correcting
a misspelled word or updating an incorrect numerical value.</p>
<p align="justify">Bugs belonging to the second category
can be rather
pernicious. In almost all instances, you will find that the model is
working fine -- that is, until you try to add in a new chemistry
simulation, diagnostic, or third-party routine. Then you may find that
a major modification to the structure of GEOS&#8211;Chem is necessary before
the new code can be successfully interfaced.</p>
<p align="justify">GEOS&#8211;Chem is a combination of several
different
indivdual pieces: emissions, chemistr and deposition routines from
Harvard, transport and convection routines fro GSFC, photolysis from UC
Irvine, etc. Therefore, the structure of GEOS&#8211;Chem was (and still is)
largely defined by the structure of the individual pieces from which it
was created. It is not always possible to deviate from this set
structure without having to rewrite entire sections of source code.</p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size18bi"><a name="7.2.1"></a>
7.2.1 Recent fixes</p>
<p align="justify"> Between each release, bugs are being
fixed:</p>
<ul>
<li>
<p align="justify">For the most recent fixes, look at
the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Bugs_and_fixes" target="_blank">Bugs and Fixes</a>
page on the GEOS&#8211;Chem wiki. It is the most up-to-date document for
bugs. For each of them, you will find a description, how to fix it and
which version of GEOS&#8211;Chem includes the fix.</p>
</li>
<li>
<p align="justify">For known bugs that are not fixed
yet, please visit <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Outstanding_issues_yet_to_be_resolved" target="_blank">Outstanding Issues Yet To Be Resolved</a>
on the wiki. </p>
</li>
</ul>
<p align="justify">If you are developing code for
GEOS&#8211;Chem, check the <a href="chapter_7.html#7.1">Coding:
Practice and Style</a> section, as well as the <a href="http://wiki.seas.harvard.edu/geos-chem/index.php/Machine_issues_%26_portability" target="_blank">Floating point page </a>on the
GEOS&#8211;Chem wiki. These pages may help you resolve some common issues. </p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size18bi"><a name="7.2.2"></a>
7.2.2 Debugging Tips</p>
<p align="justify"> Here are some steps you can take to
try to diagnose a particular GEOS&#8211;Chem error.</p>
<blockquote>
<table border="0" cellpadding="3" cellspacing="3" width="95%">
<tbody>
<tr valign="top">
<td width="4%">1.</td>
<td>
<p align="justify">Turn on diagnostic ND70 in the
file <span class="courier16">input.geos</span>.
This will cause debugging messages (via routine <span class="courier16">debug_msg</span> contained in <span class="courier16">error_mod.f</span>)
to be written to the log file after operations such as transport,
chemistry, emissions, dry deposition, etc. are called from the main
program. In this way, you should be able to identify in which operation
the error occurred. </p>
<p align="justify">NOTE: <span class="courier16">debug_msg</span>
will cause the text to be flushed to disk after it is printed. Most
Unix systems feature buffered I/O; that is, the contents of a file or
screen output are not updated until an internal buffer (usually 16K of
memory) is filled up. If you don't flush the error message to disk,
then the last output to the log file may not accurately indicate the
location at which the error occurred. Therefore, we recommend using <span class="courier16">debug_msg</span> instead of a
standard Fortran WRITE or PRINT* statement.</p>
</td>
</tr>
<tr valign="top">
<td width="4%">&nbsp;</td>
<td><br>
</td>
</tr>
<tr valign="top">
<td width="4%">2.</td>
<td>
<p align="justify">It may also be necessary to
include additional debug statements into <span class="courier16">main.f</span>
or other routines. This may be done by calling subroutine <span class="courier16">debug_msg</span> as follows</p>
<blockquote>
<pre>CALL DEBUG_MSG( '### after routine X' )</pre>
</blockquote>
<p align="justify">By adding several of these
debug statements, you should be able to
track down the particular place at which the error is occurring. </p>
</td>
</tr>
<tr valign="top">
<td width="4%">&nbsp;</td>
<td><br>
</td>
</tr>
<tr valign="top">
<td width="4%">3.</td>
<td>
<p align="justify">If
you suspect a that problem with one of the meteorological field input
files could be causing GEOS&#8211;Chem to die with an unexplained error, then
look for the following line in <span class="courier16">main.f</span>:
</p>
<blockquote>
<pre>! Update dynamic timestep <br>CALL SET_CT_DYN( INCREMENT = .TRUE. )</pre>
</blockquote>
<p align="justify"> and, immediately below, insert
the following subroutine call: </p>
<blockquote>
<pre>### Debug<br>CALL MET_FIELD_DEBUG</pre>
</blockquote>
<p align="justify">This
will cause GEOS&#8211;Chem to print out the minimum, maximum, and sum of each
meteorological field at the top of the dynamic loop. You can then
examine this output to determine if the data range of a particular
field is invalid. </p>
</td>
</tr>
<tr valign="top">
<td width="4%">&nbsp;</td>
<td><br>
</td>
</tr>
<tr>
<td>4.</td>
<td>
<p align="justify">If you want to check for
negative concentrations, NaN
or Infinite values, you can add the following line of code:</p>
<blockquote>
<pre>CALL CHECK_STT('Where I think there is a problem')</pre>
</blockquote>
<p>Make sure to add the following line at the beginning
of the subroutine where you call <span class="courier16">CHECK_STT</span>:</p>
<blockquote>
<pre>USE TRACER_MOD, &nbsp;ONLY: CHECK_STT</pre>
</blockquote>
</td>
</tr>
<tr>
<td><br>
</td>
<td><br>
</td>
</tr>
<tr valign="top">
<td width="4%">4.</td>
<td>
<p align="justify">If you want to just print out
the minimum and maximum value of an array variable that is not included
in <span class="courier16">met_field_debug</span>,
then simply add the following line of code: </p>
<blockquote>
<pre>PRINT*, '### Min, Max: ', MINVAL( X ), MAXVAL( X )<br>CALL FLUSH( 6 )</pre>
</blockquote>
<p align="justify"> where X is the name of the
variable. </p>
<p align="justify"> If you want to print out the
sum of X instead of the min and max, add this line of code: </p>
<blockquote>
<pre>PRINT*, '### Sum of X : ', SUM( X )<br>CALL FLUSH( 6 )</pre>
</blockquote>
<p align="justify"> Here we also have to call the
Fortran routine <span class="courier16">FLUSH(6)</span>,
which ensures that the output (in this case, to the screen, unit #6),
will be immediately written to disk. </p>
</td>
</tr>
<tr valign="top">
<td width="4%">&nbsp;</td>
<td><br>
</td>
</tr>
<tr valign="top">
<td width="4%">5.</td>
<td>
<p align="justify">It
is a good idea to periodically compile your code with
array-out-of-bounds error checking. This will make sure that all of the
arrays are being accessed with indices whose values fall within the
specified array dimensions. </p>
<p align="justify"> For example, if you have the
following situation in your code: </p>
<blockquote>
<pre>REAL*8 :: A(10), B(10)<br>...<br>DO I = 1, 10<br> B(I) = A(I+1)<br>ENDDO</pre>
</blockquote>
<p align="justify">then the code will try to
access the 11th element of the A array. But
since A only has 10 elements, the code will try to access the next
contiguous memory location, which may belong to a different variable
altogether. Therefore, a "junk" value will be copied into the 10th
element of the B array.</p>
</td>
</tr>
<tr valign="top">
<td width="4%">&nbsp;</td>
<td><br>
</td>
</tr>
<tr valign="top">
<td width="4%">6.</td>
<td>
<p align="justify">To invoke array-out-of-bounds
checking in your code, make clean, and then make sure you the
appropriate line in your Makefile: </p>
<blockquote>
<pre>FFLAGS = f90 -cpp -64 -O3 -OPT:reorg_common=off -C (SGI )<br>FFLAGS = f90 -cpp -convert big_endian -tune host -C (Compaq)<br>FF = pgf90 -Mpreprocess -byteswapio -Mbounds (Linux )<br>FFLAGS = f90 -xpp=cpp -O4 -xarch=v9 -C (Sparc )</pre>
</blockquote>
<p align="justify">Then
recompile your code as usual. This will build the array-out-of-bounds
checking into your executable. Any errors will be detected at runtime,
and you should get error output such as: </p>
<blockquote>
<pre>lib-4964: WARNING <br>Subscript is out of range for dimension 1 for array <br>'A' at line 8 in procedure 'MAIN__', <br>diagnosed by '__f90_bounds_check'.</pre>
</blockquote>
<p align="justify">The above error was generated
on the SGI platform; Alpha and Linux compilers should give similar
errors. </p>
<p align="justify">NOTE:
Once you have located and fixed the offending array statement, you
should recompile to make an executable without the array-out-of-bounds
checking built in. The error checking is thorough, but it can cause
your code to slow down noticeably. Therefore, it is only recommended to
use array-out-of-bounds checking in debugging runs and not in
production runs.</p>
</td>
</tr>
<tr valign="top">
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
</blockquote>
<p align="justify"></p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p class="size18bi"><a name="7.2.3"></a>
7.2.3 Using a debugger</p>
<p align="justify">If you have access to a debugger, you
should spend a
little bit of time learning how to use it, at least the basic usage.
Knowing how to:</p>
<ul>
<li> examine data when a program stops</li>
<li> navigate the stack when a program stops</li>
<li> set breakpoints, </li>
</ul>
<p align="justify">will save you a lot of time when
debugging a program.</p>
<p align="justify">To use a debugger, you typically need
to compile
your code with a flag that tells the compiler to generate symbolic
debug information. This is usually done with <strong>-g</strong>.
You
also need to switch off any optimization flag, since they can "rewrite"
your code and you may not be able to access all variables. For example,
GEOS-Chem is compiled with the following flags on IFORT when using a
debugger:</p>
<blockquote>
<pre>FFLAGS = -cpp -w -noalign -convert big_endian <strong>-g</strong></pre>
</blockquote>
<p>instead of:</p>
<blockquote>
<pre>FFLAGS = -cpp -w <strong>-O2 -auto</strong> -noalign -convert big_endian</pre>
</blockquote>
<p>To switch to the debug options simply add "DEBUG=yes" (case sensitive) to the make command.<br>
Note: Compiling with the debug option does not turn off the
parallelization. Some debugger do not accept parallelized code, to turn
off the parallelization, add "OMP=no" (case sensitive) to the make
command.</p>
<p align="center"><img src="../../../img/black_rule.jpg" height="2" width="100%"></p>
<p align="center"><span class="size14bi"><a href="chapter_6.html">Previous</a> | <a href="chapter_8.html">Next</a> | <a href="chapter_7.html" target="_parent">Printable View
(no frames)</a></span> </p>
</body></html>